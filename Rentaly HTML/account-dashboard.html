<!DOCTYPE html>
<html lang="zxx">

<head>
    <title>Admin Panel - Car Management</title>
    <link rel="icon" href="images/icon.png" type="image/gif" sizes="16x16">
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="PlusRent - Multipurpose Vehicle Car Rental Website Template" name="description">
    <meta content="" name="keywords">
    <meta content="" name="author">
    <!-- CSS Files
    ================================================== -->
    <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css" id="bootstrap">
    <link href="css/mdb.min.css" rel="stylesheet" type="text/css" id="mdb">
    <link href="css/plugins.css" rel="stylesheet" type="text/css">
    <link href="css/style.css" rel="stylesheet" type="text/css">
    <link href="css/coloring.css" rel="stylesheet" type="text/css">
    <!-- color scheme -->
    <link id="colors" href="css/colors/scheme-01.css" rel="stylesheet" type="text/css">
    <style>
      /* Autocomplete styles */
      .autocomplete-container {
        position: relative;
        display: inline-block;
        width: 100%;
      }
      
      .autocomplete-input {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
      }
      
      .autocomplete-dropdown {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border: 1px solid #ddd;
        border-top: none;
        border-radius: 0 0 4px 4px;
        max-height: 200px;
        overflow-y: auto;
        z-index: 1000;
        display: none;
      }
      
      .autocomplete-item {
        padding: 8px 12px;
        cursor: pointer;
        border-bottom: 1px solid #f0f0f0;
      }
      
      .autocomplete-item:hover {
        background-color: #f5f5f5;
      }
      
      .autocomplete-item.selected {
        background-color: #007bff;
        color: white;
      }
      
      .autocomplete-highlight {
        background-color: #ffeb3b;
        font-weight: bold;
        padding: 1px 2px;
      }
      
      .autocomplete-input.is-invalid {
        border-color: #dc3545;
        box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
      }
      
      .autocomplete-input.is-valid {
        border-color: #28a745;
        box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25);
      }
      
  .admin-main-container {
    max-width: 1400px;
    margin: 0 auto;
    padding-left: 32px;
    padding-right: 32px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .admin-header {
    text-align: center;
    margin-top: 2rem;
    margin-bottom: 1.2rem;
  }
  .admin-flex-row {
    display: flex;
    align-items: flex-start;
    gap: 32px;
    justify-content: flex-start;
    width: 100%;
  }
  .admin-btn-col {
    flex: 0 0 auto;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    min-width: 180px;
    margin-top: 0.5rem;
    margin-right: 0;
  }
  .admin-form-col {
    flex: 1 1 0;
    position: relative;
    min-width: 340px;
    max-width: 1100px;
  }
  .admin-form-panel {
    display: none;
    position: fixed;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%) scale(0.98);
    width: 90%;
    max-width: 1200px;
    min-width: 320px;
    max-height: 90vh;
    overflow-y: auto;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 4px 24px rgba(0,0,0,0.18);
    padding: 1.4rem 1.8rem 1.4rem 1.8rem;
    transition: transform 0.4s cubic-bezier(.4,0,.2,1), opacity 0.4s cubic-bezier(.4,0,.2,1);
    opacity: 0;
    z-index: 10000;
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch;
  }
  .admin-form-panel.active {
    display: block;
    transform: translate(-50%, -50%) scale(1);
    opacity: 1;
  }
  /* Prevent body scroll when popup is open */
  html.admin-popup-open, body.admin-popup-open {
    overflow: hidden !important;
    height: 100%;
    touch-action: none;
    overscroll-behavior: contain;
  }
  .admin-form-panel .btn-fullwidth {
    width: auto;
    /* min-width: 160px; */
    display: block;
    margin: 0 auto;
  }
  /* .admin-form-panel .btn {
    display: block;
    margin: 0 auto;
    min-width: 160px;
    width: auto;
  } */
  .admin-form-panel .btn-fullwidth {
    width: auto;
    min-width: 160px;
    display: block;
    margin: 0 auto;
  }
  .admin-form-panel .btn-main {
    font-size: 1.1rem;
    padding: 0.7rem 2.2rem;
    height: 44px;
    border-radius: 6px;
  }
  .admin-form-panel .close-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    background: none;
    border: none;
    font-size: 1.5rem;
    color: #888;
    cursor: pointer;
  }
  .admin-form-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 12px;
  }
  .admin-form-grid .five-column-grid {
    grid-column: 1 / -1;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 12px;
  }
  .admin-form-grid > div {
    min-width: 0;
  }
  .admin-form-panel input,
  .admin-form-panel select {
    background: #fff !important;
    height: 36px !important;
    border: 1px solid #e0e0e0;
    border-radius: 4px;
    font-size: 0.75rem;
    width: 100%;
    padding: 0 8px;
    box-sizing: border-box;
  }
  .admin-form-panel input[type="number"] {
    height: 36px !important;
  }
  .admin-form-panel .form-label {
    font-size: 0.75rem;
    font-weight: 500;
    margin-bottom: 0 !important;
    color: #333;
  }
  .admin-form-panel .form-text,
  .admin-form-panel small.form-text {
    font-size: 0.75rem !important;
    color: #666 !important;
    line-height: 1.2 !important;
    margin-top: 2px !important;
    margin-bottom: 0 !important;
    display: block !important;
  }
  .admin-form-panel .form-control {
    height: 36px !important;
    font-size: 0.75rem;
    padding: 0 8px;
    border: 1px solid #e0e0e0;
    border-radius: 4px;
  }
  .admin-form-panel input[type="date"] {
    height: 36px !important;
    font-size: 0.75rem;
    padding: 0 8px;
  }
  .admin-form-panel input:focus,
  .admin-form-panel select:focus {
    outline: 2px solid #b3c6ff;
    border-color: #b3c6ff;
  }
  .admin-form-panel fieldset {
    grid-column: 1 / -1;
  }
  .admin-form-panel .row.g-2 > div {
    min-width: 0;
  }
  .admin-overlay {
    display: none;
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(30, 30, 30, 0.65);
    z-index: 9999;
    transition: opacity 0.3s;
  }
  .admin-overlay.active {
    display: block;
  }
  .admin-confirm-modal {
    display: none;
    position: fixed;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    background: #fff;
    border-radius: 10px;
    box-shadow: 0 4px 24px rgba(0,0,0,0.18);
    padding: 1.2rem 1.5rem;
    z-index: 10001;
    min-width: 320px;
    max-width: 400px;
    text-align: center;
  }
  .admin-confirm-modal.active {
    display: block;
  }
  .admin-confirm-modal button {
    margin: 0 10px;
    min-width: 110px;
    height: 44px;
    font-size: 1rem;
    border-radius: 6px;
    font-family: inherit;
    font-weight: 500;
  }
  .admin-confirm-modal .btn-main, .admin-confirm-modal .btn-danger {
    background: #031B4E;
    color: #fff;
    border: none;
    transition: background 0.2s;
  }
  .admin-confirm-modal .btn-danger {
    background: #e74c3c;
  }
  .admin-btn-col {
    flex: 0 0 auto;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    min-width: 180px;
    margin-top: 0.5rem;
    margin-right: 0;
  }
  .admin-flex-row {
    display: flex;
    align-items: flex-start;
    gap: 32px;
    justify-content: flex-start;
    width: 100%;
  }
  .admin-flex-row + #carCards, .admin-flex-row + .row#carCards, .admin-flex-row + .row.g-4 {
    margin-top: 1.2rem !important;
  }
  #carCards {
    margin-top: 1.2rem !important;
  }
  /* Fix for car cards being too small after form grid change */
  #carCards.row.g-4 {
    display: flex;
    flex-wrap: wrap;
    justify-content: flex-start !important;
    align-items: stretch;
    width: 100%;
  }
  #carCards.row.g-4 > .col-md-6.col-lg-4 {
    min-width: 320px;
    flex: 1 1 320px;
    max-width: 320px;
    display: flex;
  }
  #carCards .card {
    min-width: 300px;
    width: 100%;
    margin: 0;
  }
  @media (max-width: 900px) {
    .admin-form-panel {
      width: 95vw;
      padding: 1.2rem 1rem;
      max-height: 95vh;
    }
    .admin-form-grid {
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    }
    .admin-form-grid .five-column-grid {
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    }
  }
  @media (max-width: 600px) {
    .admin-form-panel {
      width: 98vw;
      padding: 1rem 0.8rem;
      max-height: 98vh;
    }
    .admin-form-grid {
      grid-template-columns: 1fr;
    }
    .admin-form-grid .five-column-grid {
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
    }
  }
  @media (max-width: 480px) {
    .admin-form-panel {
      width: 100vw;
      padding: 0.8rem 0.6rem;
      max-height: 100vh;
      border-radius: 0;
    }
    .admin-form-grid {
      grid-template-columns: 1fr;
    }
    .admin-form-grid .five-column-grid {
      grid-template-columns: 1fr;
    }
    /* Stack image upload sections vertically on mobile */
    .admin-form-grid > div[style*="display: flex"] {
      flex-direction: column !important;
    }
    .admin-form-grid > div[style*="display: flex"] > div {
      width: 100% !important;
      margin-bottom: 16px;
    }
  }
  
  /* Override MDB button text-transform to use normal case */
  .btn {
    text-transform: none !important;
  }
  
  /* Prevent body scroll when modal is open */
  body.modal-open {
    overflow: hidden !important;
    position: fixed !important;
    width: 100% !important;
    left: 0 !important;
    right: 0 !important;
  }
  
  html.modal-open {
    overflow: hidden !important;
  }
  
  /* Prevent scrolling on modal overlay */
  .admin-overlay {
    overflow: hidden !important;
  }
  
  /* Gallery Carousel Styles */
  .admin-gallery-carousel {
    position: relative;
    max-width: 100%;
    margin-top: 8px;
  }
  
  .admin-carousel-container {
    position: relative;
    overflow: visible; /* Allow buttons to overflow outside */
    border-radius: 8px;
    background: #f8f9fa;
  }
  
  .admin-carousel-track-wrapper {
    overflow: hidden;
    border-radius: 8px;
  }
  
  .admin-carousel-track {
    display: flex;
    transition: transform 0.3s ease;
    gap: 10px;
    padding: 10px 3px 10px 10px; /* Balanced right padding - middle ground */
  }
  
  .admin-carousel-image-item {
    position: relative;
    flex: 0 0 auto;
    padding: 0;
  }
  
  .admin-carousel-image-item img {
    width: 100%;
    height: 150px;
    object-fit: cover;
    border-radius: 6px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    display: block;
  }
  
  .admin-carousel-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(0,0,0,0.9);
    color: white;
    border: none;
    border-radius: 50%;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 14px;
    transition: background 0.2s;
    z-index: 10;
  }
  
  .admin-carousel-nav:hover {
    background: rgba(0,0,0,1);
  }
  
  .admin-carousel-nav:disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }
  
  .admin-carousel-prev {
    left: -16px; /* Half of button width (32px / 2 = 16px) outside */
  }
  
  .admin-carousel-next {
    right: -16px; /* Half of button width (32px / 2 = 16px) outside */
  }
  
  .admin-carousel-counter {
    position: absolute;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.7);
    color: white;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 500;
  }
  
  .admin-carousel-remove {
    position: absolute;
    top: -6px;
    right: -6px;
    background: rgb(248 67 61 / 90%);
    color: #fff;
    border: none;
    border-radius: 50%;
    width: 22px;
    height: 22px;
    font-size: 15px;
    padding-bottom: 3px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
    transition: all 0.2s;
    backdrop-filter: blur(2px);
  }
  
  .admin-carousel-remove:hover {
    transform: scale(1.1);
  }
  
  /* Upload Button Styles */
  .admin-upload-area {
  position: relative;
    margin-bottom: 8px;
  }
  
  .admin-upload-button {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 60px;
    border: 2px dashed #ccc;
  border-radius: 6px;
    background: #f8f9fa;
    cursor: pointer;
    transition: all 0.2s ease;
    padding: 8px;
  }
  
  .admin-upload-button:hover {
    border-color: #007bff;
    background: #f0f8ff;
  }
  
  .admin-upload-icon {
    width: 20px;
    height: 20px;
    margin-bottom: 4px;
    color: #666;
  }
  
  .admin-upload-text {
    font-size: 0.7rem;
    font-weight: 500;
    color: #333;
    text-align: center;
    margin: 0;
  }
  
  .admin-upload-subtext {
    font-size: 0.65rem;
    color: #666;
    text-align: center;
    margin: 2px 0 0 0;
  }
  
  .admin-upload-input {
    display: none;
  }
  
  .admin-image-preview {
    margin-top: 8px;
  }
  
  /* Tab Styles */
  .admin-tabs {
  display: flex;
    gap: 10px;
    margin-bottom: 20px;
  }
  
  .admin-tab-btn {
    padding: 12px 24px;
    border: 2px solid #e0e0e0;
    background: white;
    color: #666;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 500;
    transition: all 0.3s ease;
  }
  
  .admin-tab-btn.active {
    border-color: #007bff;
    background: #007bff;
    color: white;
  }
  
  .admin-tab-btn:hover:not(.active) {
    border-color: #007bff;
    color: #007bff;
  }
  
  .admin-tab-content {
    display: none;
  }
  
  .admin-tab-content.active {
    display: block;
  }
  
  /* Coupon Card Styles */
  .coupon-card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    border: 1px solid #e0e0e0;
  }
  
  /* Booking Card Animation Styles */
  .booking-card {
    transition: all 0.3s ease;
    transform: translateX(0);
    opacity: 1;
  }
  
  .booking-card.approving {
    background: #d4edda;
    border-color: #c3e6cb;
    transform: scale(1.02);
  }
  
  .booking-card.rejecting {
    background: #f8d7da;
    border-color: #f5c6cb;
    transform: scale(1.02);
  }
  
  .booking-card.slide-out {
    transform: translateX(100%);
    opacity: 0;
  }
  
  .booking-card.fade-out {
    opacity: 0;
    transform: scale(0.95);
  }
  
  /* Button Animation Styles */
  .btn-approve, .btn-reject {
    transition: all 0.2s ease;
  }
  
  .btn-approve:active {
    transform: scale(0.95);
    background: #28a745 !important;
  }
  
  .btn-reject:active {
    transform: scale(0.95);
    background: #dc3545 !important;
  }
  
  /* Loading Animation */
  .btn-loading {
    position: relative;
    pointer-events: none;
  }
  
  .btn-loading::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 16px;
    height: 16px;
    margin: -8px 0 0 -8px;
    border: 2px solid transparent;
    border-top: 2px solid #fff;
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }
  
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  .coupon-status {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
  font-weight: 500;
  }
  
  .coupon-status.active {
    background: #d4edda;
    color: #155724;
  }
  
  .coupon-status.inactive {
    background: #f8d7da;
    color: #721c24;
  }
  
  .coupon-status.expired {
    background: #fff3cd;
    color: #856404;
  }
  
  /* Language switcher styles */
  .btn[data-lang].active {
    background-color: #007bff !important;
    color: white !important;
    border-color: #007bff !important;
    font-weight: 600;
  }
  
  .btn[data-lang]:not(.active) {
    background-color: white !important;
    color: #007bff !important;
    border-color: #007bff !important;
  }
  
  .btn[data-lang]:not(.active):hover {
    background-color: #f8f9fa !important;
  }
</style>

<!-- Custom green for success alert and Booked checkbox styles -->
<style>
:root {
  --admin-success-green: #28a745;
}
#adminCustomAlert.success {
  background: var(--admin-success-green) !important;
  color: #fff !important;
}
#adminCustomAlert.error {
  background: #e74c3c !important;
  color: #fff !important;
}
/* Remove all custom Booked checkbox and label styles */
.admin-booked-checkbox, .admin-booked-label { }
</style>
</head>

<body>
    <div id="wrapper">
        
        <!-- page preloader begin -->
        <div id="de-preloader"></div>
        <!-- page preloader close -->

        <!-- header begin -->
        <header class="transparent scroll-light has-topbar">
            <div id="topbar" class="topbar-dark text-light">
                <div class="container">
                    <div class="topbar-left xs-hide">
                        <div class="topbar-widget">
                            <div class="topbar-widget"><a href="#"><i class="fa fa-phone"></i>+208 333 9296</a></div>
                            <div class="topbar-widget"><a href="#"><i class="fa fa-envelope"></i>contact@plusrent.com</a></div>
                            <div class="topbar-widget"><a href="#"><i class="fa fa-clock-o"></i>Mon - Fri 08.00 - 18.00</a></div>
                        </div>
                    </div>
                
                    <div class="topbar-right">
                        <div class="social-icons">
                            <a href="#"><i class="fa fa-facebook fa-lg"></i></a>
                            <a href="#"><i class="fa fa-twitter fa-lg"></i></a>
                            <a href="#"><i class="fa fa-youtube fa-lg"></i></a>
                            <a href="#"><i class="fa fa-pinterest fa-lg"></i></a>
                            <a href="#"><i class="fa fa-instagram fa-lg"></i></a>
                        </div>
                    </div>  
                    <div class="clearfix"></div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <div class="de-flex sm-pt10">
                            <div class="de-flex-col">
                                <div class="de-flex-col">
                                    <!-- logo begin -->
                                    <div id="logo">
                                        <a href="index.html">
                                            <img class="logo-1" src="images/logo-light.png" alt="">
                                            <img class="logo-2" src="images/logo.png" alt="">
                                        </a>
                                    </div>
                                    <!-- logo close -->
                                </div>
                            </div>
                            <div class="de-flex-col header-col-mid">
                                <ul id="mainmenu">
                                    <li><a class="menu-item" href="index.html">Home</a></li>
                                    <li><a class="menu-item" href="cars.html">Cars</a></li>
                                    <li><a class="menu-item" href="quick-booking.html">Booking</a></li>
                                    <li><a class="menu-item" href="account-dashboard.html">Admin Panel</a></li>
                                </ul>
                            </div>
                            <div class="de-flex-col">
                                <div class="menu_side_area">
                                    <div class="de-login-menu">

                                        <span id="de-click-menu-profile" class="de-menu-profile">                           
                                            <img src="images/profile/1.jpg" class="img-fluid" alt="">
                                        </span>

                                        

                                        <div id="de-submenu-profile" class="de-submenu">
                                            <div class="d-name">
                                                <h4>Monica Lucas</h4>
                                                <span class="text-gray">monica@plusrent.com</span>
                                            </div>

                                            <div class="d-line"></div>

                                            <ul class="menu-col">
                                                <li><a href="account-dashboard.html"><i class="fa fa-home"></i>Dashboard</a></li>
                                                <li><a href="account-profile.html"><i class="fa fa-user"></i>My Profile</a></li>
                                                <li><a href="account-booking.html"><i class="fa fa-calendar"></i>My Orders</a></li>
                                                <li><a href="account-favorite.html"><i class="fa fa-car"></i>My Favorite Cars</a></li>
                                                <li><a href="login.html"><i class="fa fa-sign-out"></i>Sign Out</a></li>
                                            </ul>
                                        </div>
                                        <span id="menu-btn"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>
            <!-- header close -->
        <!-- content begin -->
        <div class="no-bottom no-top zebra" id="content">
            <div id="top"></div>
            
            <!-- section begin -->
            <section id="subheader" class="jarallax text-light">
                <img src="images/background/14.jpg" class="jarallax-img" alt="">
                    <div class="center-y relative text-center">
                        <div class="container">
                            <div class="row">
                                <div class="col-md-12 text-center">
									<h1>Admin Panel</h1>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                        </div>
                    </div>
            </section>
            <!-- section close -->

            <section id="admin-add-car" class="bg-gray-100">
              <div class="admin-main-container">
                <h3 class="admin-header mb-4" style="font-family: var(--title-font); font-weight: 600; color: #031B4E;">Admin Panel</h3>
                
                <!-- Tab Navigation -->
                <div class="admin-tabs mb-4">
                  <button class="admin-tab-btn active" data-tab="cars">Manage Cars</button>
                  <button class="admin-tab-btn" data-tab="coupons">Manage Coupon Codes</button>
                  <button class="admin-tab-btn" data-tab="bookings">Manage Bookings</button>
                </div>
                
                <!-- Language Switcher for Cars -->

                
                <!-- Cars Tab Content -->
                <div id="cars-tab" class="admin-tab-content active">
                <div class="admin-flex-row">
                  <div class="admin-btn-col">
                    <button id="showAddCarBtn" type="button" class="btn btn-main btn-lg">Add a Car</button>
                  </div>
                  <div class="admin-form-col">
                    <!-- Overlay -->
                    <div id="adminOverlay" class="admin-overlay"></div>
                    <!-- Add Car Form Panel (popup) -->
                    <div id="addCarPanel" class="admin-form-panel">
                      <button class="close-btn" id="closeAddCarPanel">&times;</button>
                      <form id="carForm" class="form-border" autocomplete="off">
                                                <h3 id="formTitle" class="mb-3" style="font-family: var(--title-font); font-weight: 600; color: #031B4E; font-size: 1.4rem;">Add Car</h3>
                          <div class="admin-form-grid">
                            <div style="grid-column: 1 / -1; display: flex; align-items: flex-start; margin-bottom: 6px; gap: 16px;">
                            <div style="flex: 1;">
                              <label class="form-label">Head Image</label>
                              <div class="admin-upload-area">
                                <div class="admin-upload-button" id="addHeadImageButton">
                                  <svg class="admin-upload-icon" viewBox="0 0 24 24" style="display: block;">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="17,8 12,3 7,8"></polyline>
                                    <line x1="12" y1="3" x2="12" y2="15"></line>
                                  </svg>
                                  <div class="admin-upload-text">Upload Head Image</div>
                                </div>
                                <input type="file" id="addHeadImageInput" name="head_image" accept="image/*" class="admin-upload-input">
                              </div>
                              <div id="addHeadImagePreview" class="admin-image-preview"></div>
                            </div>
                            <div style="flex: 1;">
                              <label class="form-label">Gallery Images (max 10)</label>
                              <div class="admin-upload-area">
                                <div class="admin-upload-button" id="addGalleryImagesButton">
                                  <svg class="admin-upload-icon" viewBox="0 0 24 24" style="display: block;">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="17,8 12,3 7,8"></polyline>
                                    <line x1="12" y1="3" x2="12" y2="15"></line>
                                  </svg>
                                  <div class="admin-upload-text">Upload Gallery Images</div>
                                </div>
                                <input type="file" id="addGalleryImagesInput" name="gallery_images" accept="image/*" multiple class="admin-upload-input">
                              </div>
                              <div id="addGalleryImagesPreview"></div>
                            </div>
                          </div>
                          <div>
                            <label class="form-label">Make Name</label>
                            <div class="autocomplete-container">
                              <input type="text" id="add_make_name" name="make_name" class="form-control autocomplete-input" placeholder="Type to search..." required>
                              <div class="autocomplete-dropdown" id="add_make_name_dropdown"></div>
                            </div>
                          </div>
                          <div>
                            <label class="form-label">Model Name</label>
                            <div class="autocomplete-container">
                              <input type="text" id="add_model_name" name="model_name" class="form-control autocomplete-input" placeholder="Type to search..." required>
                              <div class="autocomplete-dropdown" id="add_model_name_dropdown"></div>
                            </div>
                          </div>
                          <div>
                            <label class="form-label">Production Year</label>
                            <select name="production_year" class="form-control" required></select>
                          </div>
                          <div>
                            <label class="form-label">Gear Type</label>
                            <select name="gear_type" class="form-control" required>
                              <option value="Automatic">Automatic</option>
                              <option value="Manual">Manual</option>
                            </select>
                          </div>
                          <div class="five-column-grid">
                            <div>
                              <label class="form-label">Fuel Type</label>
                              <select name="fuel_type" class="form-control" required>
                                <option value="Gasoline">Gasoline</option>
                                <option value="Diesel">Diesel</option>
                                <option value="Hybrid">Hybrid</option>
                                <option value="Electric">Electric</option>
                              </select>
                            </div>
                            <div>
                              <label class="form-label">Engine Capacity</label>
                              <input type="number" name="engine_capacity" class="form-control" step="0.1" min="0">
                            </div>
                            <div>
                              <label class="form-label">Car Type</label>
                              <select name="car_type" class="form-control" required>
                                <option value="Crossover">Crossover</option>
                                <option value="Sedan">Sedan</option>
                                <option value="Coupe">Coupe</option>
                                  <option value="Minivan">Minivan</option>
                                  <option value="Hatchback">Hatchback</option>
                              </select>
                            </div>
                            <div>
                              <label class="form-label">Number of Doors</label>
                              <select name="num_doors" class="form-control" required></select>
                            </div>
                            <div>
                              <label class="form-label">Number of Passengers</label>
                              <select name="num_passengers" class="form-control" required></select>
                            </div>
                          </div>
                        </div>
                        <fieldset class="mb-3 p-2 rounded-3" style="border: 1px solid #eee;">
                          <legend class="form-label mb-2" style="font-size: 1rem; color: #031B4E;">Price Policy</legend>
                          <div class="row g-2">
                            <div class="col-12 col-md-6 col-xl-2 mb-2">
                              <label class="form-label">1-2 days</label>
                              <input type="text" name="price_1_2" class="form-control" required>
                            </div>
                            <div class="col-12 col-md-6 col-xl-2 mb-2">
                              <label class="form-label">3-7 days</label>
                              <input type="text" name="price_3_7" class="form-control" required>
                            </div>
                            <div class="col-12 col-md-6 col-xl-2 mb-2">
                              <label class="form-label">8-20 days</label>
                              <input type="text" name="price_8_20" class="form-control" required>
                            </div>
                            <div class="col-12 col-md-6 col-xl-2 mb-2">
                              <label class="form-label">21-45 days</label>
                              <input type="text" name="price_21_45" class="form-control" required>
                            </div>
                            <div class="col-12 col-md-6 col-xl-2 mb-2">
                              <label class="form-label">46+ days</label>
                              <input type="text" name="price_46" class="form-control" required>
                            </div>
                          </div>
                        </fieldset>
                        <div class="mb-3" style="max-width: 300px;">
                          <label class="form-label">Booked Until (optional)</label>
                          <input type="date" name="booked_until" class="form-control" placeholder="Select date until when car is booked">
                          <small class="form-text text-muted">Leave empty if car is available. Car will be automatically available after this date.</small>
                        </div>
                          <fieldset class="mb-3 p-2 rounded-3" style="border: 1px solid #eee;">
                            <legend class="form-label mb-2" style="font-size: 1rem; color: #031B4E;">Additional Specifications (Optional)</legend>
                            <div class="admin-form-grid">
                              <div>
                                <label class="form-label">Luggage Capacity</label>
                                <input type="text" name="luggage" class="form-control" placeholder="e.g., 2 large suitcases">
                              </div>
                              <div>
                                <label class="form-label">Mileage (km)</label>
                                <input type="number" name="mileage" class="form-control" placeholder="e.g., 50000" min="0">
                              </div>
                              <div>
                                <label class="form-label">Drive Type</label>
                                <select name="drive" class="form-control">
                                  <option value="">Select drive type</option>
                                  <option value="Front Wheel Drive">Front Wheel Drive</option>
                                  <option value="Rear Wheel Drive">Rear Wheel Drive</option>
                                  <option value="All Wheel Drive">All Wheel Drive</option>
                                  <option value="4 Wheel Drive">4 Wheel Drive</option>
                                </select>
                              </div>
                              <div>
                                <label class="form-label" id="fuel-economy-label">Fuel Economy (L/100km)</label>
                                <input type="number" name="fuel_economy" class="form-control" placeholder="e.g., 7.5" step="0.1" min="0">
                              </div>
                              <div>
                                <label class="form-label">Exterior Color</label>
                                <input type="text" name="exterior_color" class="form-control" placeholder="e.g., Pearl White">
                              </div>
                              <div>
                                <label class="form-label">Interior Color</label>
                                <input type="text" name="interior_color" class="form-control" placeholder="e.g., Black Leather">
                              </div>
                            </div>
                          </fieldset>
                          <fieldset class="mb-3 p-2 rounded-3" style="border: 1px solid #eee;">
                            <legend class="form-label mb-2" style="font-size: 1rem; color: #031B4E;">Insurance Pricing (Required)</legend>
                            <div class="admin-form-grid">
                              <div>
                                <label class="form-label">RCA Insurance Price (€/day)</label>
                                <input type="number" name="rca_insurance_price" class="form-control" placeholder="e.g., 15" step="0.01" min="0" required>
                              </div>
                              <div>
                                <label class="form-label">Casco Insurance Price (€/day)</label>
                                <input type="number" name="casco_insurance_price" class="form-control" placeholder="e.g., 25" step="0.01" min="0" required>
                              </div>
                            </div>
                          </fieldset>
                          <fieldset class="mb-3 p-2 rounded-3" style="border: 1px solid #eee;">
                        <button type="submit" id="formSubmitBtn" class="btn btn-main">Add Car</button>
                      </form>
                    </div>
                    <!-- Edit Car Form Panel (popup) -->
                    <div id="editCarPanel" class="admin-form-panel">
                      <button class="close-btn" id="closeEditCarPanel">&times;</button>
                      <button id="deleteCarBtn" type="button" style="position:absolute;top:16px;right:48px;background:none;border:1.5px solid #e74c3c;color:#e74c3c;padding:6px 14px;border-radius:6px;font-size:1rem;display:flex;align-items:center;gap:6px;cursor:pointer;z-index:2;">
                        <i class="fa fa-trash"></i> Delete Car
                      </button>
                      <form id="editCarForm" class="form-border" autocomplete="off">
                                                <h3 class="mb-3" style="font-family: var(--title-font); font-weight: 600; color: #031B4E; font-size: 1.4rem;">Edit Car</h3>
                          <div class="admin-form-grid">
                            <div style="grid-column: 1 / -1; display: flex; align-items: flex-start; margin-bottom: 6px; gap: 16px;">
                            <div style="flex: 1;">
                              <label class="form-label">Head Image</label>
                              <div class="admin-upload-area">
                                <div class="admin-upload-button" id="editHeadImageButton">
                                  <svg class="admin-upload-icon" viewBox="0 0 24 24" style="display: block;">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="17,8 12,3 7,8"></polyline>
                                    <line x1="12" y1="3" x2="12" y2="15"></line>
                                  </svg>
                                  <div class="admin-upload-text">Upload Head Image</div>
                                </div>
                                <input type="file" id="editHeadImageInput" name="head_image" accept="image/*" class="admin-upload-input">
                              </div>
                              <div id="editHeadImagePreview" class="admin-image-preview"></div>
                            </div>
                            <div style="flex: 1;">
                              <label class="form-label">Gallery Images (max 10)</label>
                              <div class="admin-upload-area">
                                <div class="admin-upload-button" id="editGalleryImagesButton">
                                  <svg class="admin-upload-icon" viewBox="0 0 24 24" style="display: block;">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="17,8 12,3 7,8"></polyline>
                                    <line x1="12" y1="3" x2="12" y2="15"></line>
                                  </svg>
                                  <div class="admin-upload-text">Upload Gallery Images</div>
                                </div>
                                <input type="file" id="editGalleryImagesInput" name="gallery_images" accept="image/*" multiple class="admin-upload-input">
                              </div>
                              <div id="editGalleryImagesPreview"></div>
                            </div>
                          </div>
                          <div style="grid-column: 1 / -1; margin-bottom: 8px; max-width: 300px;">
                            <label class="form-label">Booked Until (optional)</label>
                            <input type="date" name="booked_until" class="form-control" placeholder="Select date until when car is booked">
                            <small class="form-text text-muted">Leave empty if car is available. Car will be automatically available after this date.</small>
                          </div>
                          <div>
                            <label class="form-label">Make Name</label>
                            <select name="make_name" class="form-control" required>
                              <option value="">Select Make</option>
                            </select>
                          </div>
                          <div>
                            <label class="form-label">Model Name</label>
                            <select name="model_name" class="form-control" required>
                              <option value="">Select Model</option>
                            </select>
                          </div>
                          <div>
                            <label class="form-label">Production Year</label>
                            <select name="production_year" class="form-control" required></select>
                          </div>
                          <div>
                            <label class="form-label">Gear Type</label>
                            <select name="gear_type" class="form-control" required>
                              <option value="Automatic">Automatic</option>
                              <option value="Manual">Manual</option>
                            </select>
                          </div>
                          <div class="five-column-grid">
                            <div>
                              <label class="form-label">Fuel Type</label>
                              <select name="fuel_type" class="form-control" required>
                                <option value="Gasoline">Gasoline</option>
                                <option value="Diesel">Diesel</option>
                                <option value="Hybrid">Hybrid</option>
                                <option value="Electric">Electric</option>
                              </select>
                            </div>
                            <div>
                              <label class="form-label">Engine Capacity</label>
                              <input type="number" name="engine_capacity" class="form-control" step="0.1" min="0">
                            </div>
                            <div>
                              <label class="form-label">Car Type</label>
                              <select name="car_type" class="form-control" required>
                                <option value="Crossover">Crossover</option>
                                <option value="Sedan">Sedan</option>
                                <option value="Coupe">Coupe</option>
                                  <option value="Minivan">Minivan</option>
                                  <option value="Hatchback">Hatchback</option>
                              </select>
                            </div>
                            <div>
                              <label class="form-label">Number of Doors</label>
                              <select name="num_doors" class="form-control" required></select>
                            </div>
                            <div>
                              <label class="form-label">Number of Passengers</label>
                              <select name="num_passengers" class="form-control" required></select>
                            </div>
                          </div>
                        </div>
                        <fieldset class="mb-3 p-2 rounded-3" style="border: 1px solid #eee;">
                          <legend class="form-label mb-2" style="font-size: 1rem; color: #031B4E;">Price Policy</legend>
                          <div class="row g-2">
                            <div class="col-12 col-md-6 col-xl-2 mb-2">
                              <label class="form-label">1-2 days</label>
                              <input type="text" name="price_1_2" class="form-control" required>
                            </div>
                            <div class="col-12 col-md-6 col-xl-2 mb-2">
                              <label class="form-label">3-7 days</label>
                              <input type="text" name="price_3_7" class="form-control" required>
                            </div>
                            <div class="col-12 col-md-6 col-xl-2 mb-2">
                              <label class="form-label">8-20 days</label>
                              <input type="text" name="price_8_20" class="form-control" required>
                            </div>
                            <div class="col-12 col-md-6 col-xl-2 mb-2">
                              <label class="form-label">21-45 days</label>
                              <input type="text" name="price_21_45" class="form-control" required>
                            </div>
                            <div class="col-12 col-md-6 col-xl-2 mb-2">
                              <label class="form-label">46+ days</label>
                              <input type="text" name="price_46" class="form-control" required>
                            </div>
                          </div>
                        </fieldset>
                          <fieldset class="mb-3 p-2 rounded-3" style="border: 1px solid #eee;">
                            <legend class="form-label mb-2" style="font-size: 1rem; color: #031B4E;">Additional Specifications (Optional)</legend>
                            <div class="admin-form-grid">
                              <div>
                                <label class="form-label">Luggage Capacity</label>
                                <input type="text" name="luggage" class="form-control" placeholder="e.g., 2 large suitcases">
                              </div>
                              <div>
                                <label class="form-label">Mileage (km)</label>
                                <input type="number" name="mileage" class="form-control" placeholder="e.g., 50000" min="0">
                              </div>
                              <div>
                                <label class="form-label">Drive Type</label>
                                <select name="drive" class="form-control">
                                  <option value="">Select drive type</option>
                                  <option value="Front Wheel Drive">Front Wheel Drive</option>
                                  <option value="Rear Wheel Drive">Rear Wheel Drive</option>
                                  <option value="All Wheel Drive">All Wheel Drive</option>
                                  <option value="4 Wheel Drive">4 Wheel Drive</option>
                                </select>
                              </div>
                              <div>
                                <label class="form-label" id="fuel-economy-label">Fuel Economy (L/100km)</label>
                                <input type="number" name="fuel_economy" class="form-control" placeholder="e.g., 7.5" step="0.1" min="0">
                              </div>
                              <div>
                                <label class="form-label">Exterior Color</label>
                                <input type="text" name="exterior_color" class="form-control" placeholder="e.g., Pearl White">
                              </div>
                              <div>
                                <label class="form-label">Interior Color</label>
                                <input type="text" name="interior_color" class="form-control" placeholder="e.g., Black Leather">
                              </div>
                            </div>
                          </fieldset>
                          <fieldset class="mb-3 p-2 rounded-3" style="border: 1px solid #eee;">
                            <legend class="form-label mb-2" style="font-size: 1rem; color: #031B4E;">Insurance Pricing (Required)</legend>
                            <div class="admin-form-grid">
                              <div>
                                <label class="form-label">RCA Insurance Price (€/day)</label>
                                <input type="number" name="rca_insurance_price" class="form-control" placeholder="e.g., 15" step="0.01" min="0" required>
                              </div>
                              <div>
                                <label class="form-label">Casco Insurance Price (€/day)</label>
                                <input type="number" name="casco_insurance_price" class="form-control" placeholder="e.g., 25" step="0.01" min="0" required>
                              </div>
                            </div>
                          </fieldset>
                          <fieldset class="mb-3 p-2 rounded-3" style="border: 1px solid #eee;">
                        <button type="submit" id="editFormSubmitBtn" class="btn btn-main">Confirm changes</button>
                      </form>
                    </div>
                    <!-- Confirm Modal -->
                    <div id="adminConfirmModal" class="admin-confirm-modal">
                      <h4>Are you sure you want to close this form? All unsaved data will be lost.</h4>
                      <div class="mt-4 d-flex justify-content-center gap-3">
                        <button id="confirmCloseBtn" class="btn btn-danger">Close</button>
                        <button id="cancelCloseBtn" class="btn btn-main">Cancel</button>
                      </div>
                    </div>
                    <!-- Add a confirmation modal for delete -->
                    <div id="deleteConfirmModal" class="admin-confirm-modal">
                      <h4>Are you sure you want to delete this car?</h4>
                      <div class="mt-4 d-flex justify-content-center gap-3">
                        <button id="confirmDeleteBtn" class="btn btn-danger">Yes Delete</button>
                        <button id="cancelDeleteBtn" class="btn btn-main">Cancel</button>
                      </div>
                    </div>
                      

                  </div>
                </div>
                <div id="carCards" class="row g-4 mt-4"></div>
                </div>
                
                <!-- Coupon Codes Tab Content -->
                <div id="coupons-tab" class="admin-tab-content">
                  <div class="admin-flex-row">
                    <div class="admin-btn-col">
                      <button id="showAddCouponBtn" type="button" class="btn btn-main btn-lg">Add Coupon Code</button>
                    </div>
                    <div class="admin-form-col">
                      <!-- Overlay -->
                      <div id="couponOverlay" class="admin-overlay"></div>
                      <!-- Add Coupon Form Panel (popup) -->
                      <div id="addCouponPanel" class="admin-form-panel">
                        <button class="close-btn" id="closeAddCouponPanel">&times;</button>
                        <form id="couponForm" class="form-border" autocomplete="off">
                          <h3 id="couponFormTitle" class="mb-3" style="font-family: var(--title-font); font-weight: 600; color: #031B4E; font-size: 1.4rem;">Add Coupon Code</h3>
                          <div class="admin-form-grid">
                            <div>
                              <label class="form-label">Coupon Code</label>
                              <input type="text" name="code" class="form-control" placeholder="e.g., WELCOME10" required>
                            </div>
                            <div>
                              <label class="form-label">Discount Percentage</label>
                              <input type="number" name="discount_percentage" class="form-control" placeholder="e.g., 15" min="1" max="100" step="0.01" required>
                            </div>
                            <div>
                              <label class="form-label">Description</label>
                              <textarea name="description" class="form-control" placeholder="e.g., Welcome discount for new customers" rows="3"></textarea>
                            </div>
                            <div>
                              <label class="form-label">Expiry Date (Optional)</label>
                              <input type="datetime-local" name="expires_at" class="form-control">
                            </div>
                            <div>
                              <label class="form-label">Status</label>
                              <select name="is_active" class="form-control" required>
                                <option value="1">Active</option>
                                <option value="0">Inactive</option>
                              </select>
                            </div>
                          </div>
                          <button type="submit" id="couponFormSubmitBtn" class="btn btn-main">Add Coupon</button>
                        </form>
                      </div>
                      <!-- Edit Coupon Form Panel (popup) -->
                      <div id="editCouponPanel" class="admin-form-panel">
                        <button class="close-btn" id="closeEditCouponPanel">&times;</button>
                        <button id="deleteCouponBtn" type="button" style="position:absolute;top:16px;right:48px;background:none;border:1.5px solid #e74c3c;color:#e74c3c;padding:6px 14px;border-radius:6px;font-size:1rem;display:flex;align-items:center;gap:6px;cursor:pointer;z-index:2;">
                          <i class="fa fa-trash"></i> Delete Coupon
                        </button>
                        <form id="editCouponForm" class="form-border" autocomplete="off">
                          <h3 class="mb-3" style="font-family: var(--title-font); font-weight: 600; color: #031B4E; font-size: 1.4rem;">Edit Coupon Code</h3>
                          <div class="admin-form-grid">
                            <div>
                              <label class="form-label">Coupon Code</label>
                              <input type="text" name="code" class="form-control" placeholder="e.g., WELCOME10" required>
                            </div>
                            <div>
                              <label class="form-label">Discount Percentage</label>
                              <input type="number" name="discount_percentage" class="form-control" placeholder="e.g., 15" min="1" max="100" step="0.01" required>
                            </div>
                            <div>
                              <label class="form-label">Description</label>
                              <textarea name="description" class="form-control" placeholder="e.g., Welcome discount for new customers" rows="3"></textarea>
                            </div>
                            <div>
                              <label class="form-label">Expiry Date (Optional)</label>
                              <input type="datetime-local" name="expires_at" class="form-control">
                            </div>
                            <div>
                              <label class="form-label">Status</label>
                              <select name="is_active" class="form-control" required>
                                <option value="1">Active</option>
                                <option value="0">Inactive</option>
                              </select>
                            </div>
                          </div>
                          <button type="submit" id="editCouponFormSubmitBtn" class="btn btn-main">Update Coupon</button>
                        </form>
                      </div>
                    </div>
                  </div>
                  <div id="couponCards" class="row g-4 mt-4"></div>
                </div>

                <!-- Bookings Tab Content -->
                <div id="bookings-tab" class="admin-tab-content">
                  <div class="admin-flex-row">
                    <div class="admin-btn-col">
                      <h4>Pending Bookings</h4>
                      <p class="text-muted">Review and approve/reject booking requests</p>
                    </div>
                    <div class="admin-form-col">
                      <div id="bookingsList" class="row g-4">
                        <!-- Bookings will be loaded here -->
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </section>
			
			
        </div>
        <!-- content close -->

        <a href="#" id="back-to-top"></a>
        
        <!-- footer begin -->
        <footer class="text-light">
            <div class="container">
                <div class="row g-custom-x">
                    <div class="col-lg-3">
                        <div class="widget">
                            <h5>About PlusRent</h5>
                            <p>Where quality meets affordability. We understand the importance of a smooth and enjoyable journey without the burden of excessive costs. That's why we have meticulously crafted our offerings to provide you with top-notch vehicles at minimum expense.</p>
                        </div>
                    </div>
                    
                    <div class="col-lg-3">
                        <div class="widget">
                            <h5>Contact Info</h5>
                            <address class="s1">
                                <span><i class="id-color fa fa-map-marker fa-lg"></i>08 W 36th St, New York, NY 10001</span>
                                <span><i class="id-color fa fa-phone fa-lg"></i>+1 333 9296</span>
                                <span><i class="id-color fa fa-envelope-o fa-lg"></i><a href="mailto:contact@example.com">contact@example.com</a></span>
                                <span><i class="id-color fa fa-file-pdf-o fa-lg"></i><a href="#">Download Brochure</a></span>
                            </address>
                        </div>
                    </div>

                    <div class="col-lg-3">
                        <h5>Quick Links</h5>
                        <div class="row">
                            <div class="col-lg-6">
                                <div class="widget">
                                    <ul>
                                        <li><a href="#">About</a></li>
                                        <li><a href="#">Blog</a></li>
                                        <li><a href="#">Careers</a></li>
                                        <li><a href="#">News</a></li>
                                        <li><a href="#">Partners</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-3">
                        <div class="widget">
                            <h5>Social Network</h5>
                            <div class="social-icons">
                                <a href="#"><i class="fa fa-facebook fa-lg"></i></a>
                                <a href="#"><i class="fa fa-twitter fa-lg"></i></a>
                                <a href="#"><i class="fa fa-linkedin fa-lg"></i></a>
                                <a href="#"><i class="fa fa-pinterest fa-lg"></i></a>
                                <a href="#"><i class="fa fa-rss fa-lg"></i></a>
                            </div>
                        </div>    
                    </div>
                </div>
            </div>
            <div class="subfooter">
                <div class="container">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="de-flex">
                                <div class="de-flex-col">
                                    <a href="index.html">
                                        Copyright 2025 - PlusRent by Designesia
                                    </a>
                                </div>
                                <ul class="menu-simple">
                                    <li><a href="#">Terms &amp; Conditions</a></li>
                                    <li><a href="#">Privacy Policy</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
        <!-- footer close -->
        
    </div>

    <!-- Custom Alert -->
    <div id="adminCustomAlert" style="display:none;position:fixed;top:32px;left:50%;transform:translateX(-50%);z-index:10002;min-width:320px;max-width:90vw;padding:16px 32px;border-radius:8px;font-size:1.1rem;font-weight:500;box-shadow:0 4px 24px rgba(0,0,0,0.12);background:#031B4E;color:#fff;text-align:center;transition:opacity 0.3s;opacity:0;"></div>


    <!-- Javascript Files
    ================================================== -->
    <script src="js/plugins.js"></script>
    <script src="js/designesia.js"></script>
    <script src="js/config.js"></script>
    <script>
        // Authentication check
        document.addEventListener('DOMContentLoaded', function() {
            const token = localStorage.getItem('adminToken');
            const user = localStorage.getItem('adminUser');
            
            if (!token || !user) {
                // Redirect to login if not authenticated
                window.location.href = 'login.html';
                return;
            }
            
            // Verify token is still valid
            fetch(`${window.API_BASE_URL}/api/auth/verify`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            })
            .then(response => {
                if (!response.ok) {
                    // Token is invalid, redirect to login
                    localStorage.removeItem('adminToken');
                    localStorage.removeItem('adminUser');
                    window.location.href = 'login.html';
                }
            })
            .catch(error => {
                console.error('Token verification error:', error);
                // Network error, but we'll allow access for now
            });
            
            // Add logout functionality
            const logoutBtn = document.createElement('button');
            logoutBtn.textContent = 'Logout';
            logoutBtn.className = 'btn-main';
            logoutBtn.style.position = 'fixed';
            logoutBtn.style.top = '20px';
            logoutBtn.style.right = '20px';
            logoutBtn.style.zIndex = '10001';
            
            logoutBtn.addEventListener('click', function() {
                localStorage.removeItem('adminToken');
                localStorage.removeItem('adminUser');
                window.location.href = 'login.html';
            });
            
            document.body.appendChild(logoutBtn);
        });
    </script>

    <!-- Global Booking Management Functions -->
    <script>
    // Global booking management functions
    async function approveBooking(bookingId, button) {
      if (!window.API_BASE_URL) {
        console.error('API_BASE_URL not defined');
        return;
      }
      
      // Find the booking card
      const bookingCard = button.closest('.booking-card');
      if (!bookingCard) return;
      
      // Add loading state to button
      button.classList.add('btn-loading');
      button.disabled = true;
      
      // Add approving animation to card
      bookingCard.classList.add('approving');
      
      try {
        const response = await fetch(`${window.API_BASE_URL}/api/bookings/${bookingId}/confirm`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' }
        });
        
        if (response.ok) {
          // Success animation - slide out
          bookingCard.classList.remove('approving');
          bookingCard.classList.add('slide-out');
          
          // Remove card after animation
          setTimeout(() => {
            bookingCard.remove();
            // Refresh list if no more bookings
            const remainingCards = document.querySelectorAll('.booking-card');
            if (remainingCards.length === 0) {
              loadPendingBookings();
            }
          }, 300);
        } else {
          const error = await response.json();
          console.error('Error approving booking:', error.error);
          
          // Remove loading state
          bookingCard.classList.remove('approving');
          button.classList.remove('btn-loading');
          button.disabled = false;
        }
      } catch (error) {
        console.error('Error approving booking:', error);
        
        // Remove loading state
        bookingCard.classList.remove('approving');
        button.classList.remove('btn-loading');
        button.disabled = false;
      }
    }

    async function rejectBooking(bookingId, button) {
      if (!window.API_BASE_URL) {
        console.error('API_BASE_URL not defined');
        return;
      }
      
      // Find the booking card
      const bookingCard = button.closest('.booking-card');
      if (!bookingCard) return;
      
      // Add loading state to button
      button.classList.add('btn-loading');
      button.disabled = true;
      
      // Add rejecting animation to card
      bookingCard.classList.add('rejecting');
      
      const reason = ''; // No prompt needed
      
      try {
        const response = await fetch(`${window.API_BASE_URL}/api/bookings/${bookingId}/reject`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ reason: reason || 'No reason provided' })
        });
        
        if (response.ok) {
          // Success animation - slide out
          bookingCard.classList.remove('rejecting');
          bookingCard.classList.add('slide-out');
          
          // Remove card after animation
          setTimeout(() => {
            bookingCard.remove();
            // Refresh list if no more bookings
            const remainingCards = document.querySelectorAll('.booking-card');
            if (remainingCards.length === 0) {
              loadPendingBookings();
            }
          }, 300);
        } else {
          const error = await response.json();
          console.error('Error rejecting booking:', error.error);
          
          // Remove loading state
          bookingCard.classList.remove('rejecting');
          button.classList.remove('btn-loading');
          button.disabled = false;
        }
      } catch (error) {
        console.error('Error rejecting booking:', error);
        
        // Remove loading state
        bookingCard.classList.remove('rejecting');
        button.classList.remove('btn-loading');
        button.disabled = false;
      }
    }

    // Global alert function
    function showCustomAlert(message, type = 'info') {
      const alert = document.getElementById('adminCustomAlert');
      if (!alert) return;
      
      alert.textContent = message;
      alert.style.background = type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : '#031B4E';
      alert.style.display = 'block';
      alert.style.opacity = '1';
      
      setTimeout(() => {
        alert.style.opacity = '0';
        setTimeout(() => {
          alert.style.display = 'none';
        }, 300);
      }, 3000);
    }

    // Global function to load pending bookings
    async function loadPendingBookings() {
      if (!window.API_BASE_URL) {
        console.error('API_BASE_URL not defined');
        return;
      }
      
      try {
        const response = await fetch(`${window.API_BASE_URL}/api/bookings`);
        const bookings = await response.json();
        
        const bookingsList = document.getElementById('bookingsList');
        if (!bookingsList) return;
        
        const pendingBookings = bookings.filter(booking => booking.status === 'pending');
        
        if (pendingBookings.length === 0) {
          bookingsList.innerHTML = '<div class="col-12"><div class="alert alert-info">No pending bookings found.</div></div>';
          return;
        }
        
        bookingsList.innerHTML = pendingBookings.map(booking => `
          <div class="col-12">
            <div class="card booking-card" data-booking-id="${booking.id}">
              <div class="card-body">
                <div class="row">
                  <div class="col-md-8">
                    <h5 class="card-title">${booking.make_name} ${booking.model_name} (${booking.production_year})</h5>
                    <p class="card-text">
                      <strong>Dates:</strong> ${booking.pickup_date} ${booking.pickup_time} - ${booking.return_date} ${booking.return_time}<br>
                      <strong>Insurance:</strong> ${booking.insurance_type}<br>
                      <strong>Pickup:</strong> ${booking.pickup_location} | <strong>Dropoff:</strong> ${booking.dropoff_location}<br>
                      <strong>Total Price:</strong> €${booking.total_price}<br>
                      <strong>Contact:</strong> ${booking.contact_person || 'Not provided'} | ${booking.contact_phone || 'Not provided'}<br>
                      <strong>Special Instructions:</strong> ${booking.special_instructions || 'None'}
                    </p>
                  </div>
                  <div class="col-md-4 text-end">
                    <div class="btn-group-vertical w-100">
                      <button class="btn btn-success mb-2 btn-approve" onclick="approveBooking(${booking.id}, this)">
                        <i class="fa fa-check"></i> Approve
                      </button>
                      <button class="btn btn-danger btn-reject" onclick="rejectBooking(${booking.id}, this)">
                        <i class="fa fa-times"></i> Reject
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `).join('');
        
      } catch (error) {
        console.error('Error loading bookings:', error);
        document.getElementById('bookingsList').innerHTML = '<div class="col-12"><div class="alert alert-danger">Error loading bookings.</div></div>';
      }
    }

    // Admin Dashboard Main Functionality
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize tab navigation
      initializeTabs();
      
      // Initialize form dropdowns
      initializeFormDropdowns();
      
      // Load initial data
      loadCars();
      loadCoupons();
      loadPendingBookings();
      
      // Initialize form handlers
      initializeCarForms();
      initializeCouponForms();
    });

    // Tab Navigation
    function initializeTabs() {
      const tabButtons = document.querySelectorAll('.admin-tab-btn');
      const tabContents = document.querySelectorAll('.admin-tab-content');
      
      tabButtons.forEach(button => {
        button.addEventListener('click', function() {
          const targetTab = this.getAttribute('data-tab');
          
          // Remove active class from all buttons and contents
          tabButtons.forEach(btn => btn.classList.remove('active'));
          tabContents.forEach(content => content.classList.remove('active'));
          
          // Add active class to clicked button and corresponding content
          this.classList.add('active');
          document.getElementById(targetTab + '-tab').classList.add('active');
        });
      });
    }

    // Initialize Form Dropdowns
    function initializeFormDropdowns() {
      // Production Year dropdown (current year to 1990)
      const productionYearSelects = document.querySelectorAll('select[name="production_year"]');
      const currentYear = new Date().getFullYear();
      productionYearSelects.forEach(select => {
        for (let year = currentYear; year >= 1990; year--) {
          const option = document.createElement('option');
          option.value = year;
          option.textContent = year;
          select.appendChild(option);
        }
      });
      
      // Number of Doors dropdown
      const numDoorsSelects = document.querySelectorAll('select[name="num_doors"]');
      numDoorsSelects.forEach(select => {
        for (let doors = 2; doors <= 5; doors++) {
          const option = document.createElement('option');
          option.value = doors;
          option.textContent = doors;
          select.appendChild(option);
        }
      });
      
      // Number of Passengers dropdown
      const numPassengersSelects = document.querySelectorAll('select[name="num_passengers"]');
      numPassengersSelects.forEach(select => {
        for (let passengers = 2; passengers <= 8; passengers++) {
          const option = document.createElement('option');
          option.value = passengers;
          option.textContent = passengers;
          select.appendChild(option);
        }
      });
    }

    // Car Management Functions
    async function loadCars() {
      if (!window.API_BASE_URL) {
        console.error('API_BASE_URL not defined');
        return;
      }
      
      try {
        const response = await fetch(`${window.API_BASE_URL}/api/cars`);
        const cars = await response.json();
        
        const carCards = document.getElementById('carCards');
        if (!carCards) return;
        
        if (cars.length === 0) {
          carCards.innerHTML = '<div class="col-12"><div class="alert alert-info">No cars found. Add your first car!</div></div>';
          return;
        }
        
                    carCards.innerHTML = cars.map(car => `
          <div class="col-md-6 col-lg-4">
            <div class="de-item">
              <div class="d-image">
                <img src="${car.head_image || 'http://localhost:3001/uploads/placeholder.png'}" class="img-fluid" alt="${car.make_name} ${car.model_name}" style="width: 100%; height: 200px; object-fit: cover;" onerror="this.src='http://localhost:3001/uploads/placeholder.png'">
              </div>
              <div class="d-info">
                <div class="d-text">
                  <h4>${formatDisplayText(car.make_name)}</h4>
                                      <p>${formatDisplayText(car.model_name)}</p>
                  <div class="d-atr-group">
                    <span class="d-atr"><img src="images/icons/1-green.svg" alt=""> ${car.num_passengers || '-'}</span>
                    <span class="d-atr"><img src="images/icons/2-green.svg" alt=""> ${car.num_doors || '-'}</span>
                    <span class="d-atr"><img src="images/icons/3-green.svg" alt="">${car.luggage || '-'}</span>
                    <span class="d-atr"><img src="images/icons/4-green.svg" alt="" ${car.car_type || '-'}</span>
                  </div>
                  <div class="d-price">Daily rate from <span>€${car.price_policy && car.price_policy['1-2'] ? car.price_policy['1-2'] : 'N/A'}</span></div>
                  <div class="d-flex gap-2 mt-3">
                    <button class="btn btn-primary btn-sm" onclick="editCar(${car.id})">
                      <i class="fa fa-edit"></i> Edit
                    </button>
                    <button class="btn btn-danger btn-sm" onclick="deleteCar(${car.id})">
                      <i class="fa fa-trash"></i> Delete
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `).join('');
        
      } catch (error) {
        console.error('Error loading cars:', error);
        document.getElementById('carCards').innerHTML = '<div class="col-12"><div class="alert alert-danger">Error loading cars.</div></div>';
      }
    }

    // Coupon Management Functions
    async function loadCoupons() {
      if (!window.API_BASE_URL) {
        console.error('API_BASE_URL not defined');
        return;
      }
      
      try {
        const response = await fetch(`${window.API_BASE_URL}/api/coupons`);
        const coupons = await response.json();
        
        const couponCards = document.getElementById('couponCards');
        if (!couponCards) return;
        
        if (coupons.length === 0) {
          couponCards.innerHTML = '<div class="col-12"><div class="alert alert-info">No coupon codes found. Add your first coupon!</div></div>';
          return;
        }
        
        couponCards.innerHTML = coupons.map(coupon => `
          <div class="col-md-6 col-lg-4">
            <div class="coupon-card">
              <div class="d-flex justify-content-between align-items-start mb-3">
                <h5 class="card-title mb-0">${coupon.code}</h5>
                <span class="coupon-status ${coupon.is_active ? 'active' : 'inactive'}">
                  ${coupon.is_active ? 'Active' : 'Inactive'}
                </span>
              </div>
              <p class="card-text">
                <strong>Discount:</strong> ${coupon.discount_percentage}%<br>
                <strong>Description:</strong> ${coupon.description || 'No description'}<br>
                ${coupon.expires_at ? `<strong>Expires:</strong> ${new Date(coupon.expires_at).toLocaleDateString()}` : ''}
              </p>
              <div class="d-flex gap-2">
                <button class="btn btn-primary btn-sm" onclick="editCoupon(${coupon.id})">
                  <i class="fa fa-edit"></i> Edit
                </button>
                <button class="btn btn-danger btn-sm" onclick="deleteCoupon(${coupon.id})">
                  <i class="fa fa-trash"></i> Delete
                </button>
              </div>
            </div>
          </div>
        `).join('');
        
      } catch (error) {
        console.error('Error loading coupons:', error);
        document.getElementById('couponCards').innerHTML = '<div class="col-12"><div class="alert alert-danger">Error loading coupons.</div></div>';
      }
    }

    // Form Handlers
    function initializeCarForms() {
      // Populate dropdown options
      function populateDropdowns() {
        // Production year dropdown (current year to 1990)
        const productionYearSelects = document.querySelectorAll('select[name="production_year"]');
        productionYearSelects.forEach(select => {
          if (select.children.length === 0) {
            const currentYear = new Date().getFullYear();
            for (let year = currentYear; year >= 1990; year--) {
              const option = document.createElement('option');
              option.value = year;
              option.textContent = year;
              select.appendChild(option);
            }
          }
        });

        // Number of doors dropdown
        const numDoorsSelects = document.querySelectorAll('select[name="num_doors"]');
        numDoorsSelects.forEach(select => {
          if (select.children.length === 0) {
            for (let doors = 2; doors <= 5; doors++) {
              const option = document.createElement('option');
              option.value = doors;
              option.textContent = doors;
              select.appendChild(option);
            }
          }
        });

        // Number of passengers dropdown
        const numPassengersSelects = document.querySelectorAll('select[name="num_passengers"]');
        numPassengersSelects.forEach(select => {
          if (select.children.length === 0) {
            for (let passengers = 2; passengers <= 8; passengers++) {
              const option = document.createElement('option');
              option.value = passengers;
              option.textContent = passengers;
              select.appendChild(option);
            }
          }
        });

        // Populate car makes dropdown
        const makeSelects = document.querySelectorAll('select[name="make_name"]');
        makeSelects.forEach(select => {
          if (select.children.length <= 1) { // Only has "Select Make" option
            const makes = [
              'bmw', 'mercedes', 'audi', 'volkswagen', 'toyota', 'honda', 'ford', 'chevrolet', 
              'nissan', 'hyundai', 'kia', 'mazda', 'subaru', 'volvo', 'lexus', 'infiniti', 
              'acura', 'buick', 'cadillac', 'chrysler', 'dodge', 'jeep', 'ram', 'gmc', 
              'pontiac', 'saturn', 'oldsmobile', 'plymouth', 'eagle', 'tesla', 'ferrari', 
              'lamborghini', 'porsche', 'maserati', 'aston_martin', 'bentley', 'rolls_royce', 
              'mclaren', 'bugatti', 'koenigsegg', 'pagani', 'rimac', 'lotus', 'alpine', 
              'caterham', 'ariel', 'noble', 'radical', 'ultima', 'zenvo', 'gumpert', 
              'saleen', 'hennessey', 'callaway', 'ruf', 'techart', 'mansory', 'brabus', 
              'alpina', 'hamann', 'hartge', 'ac_schnitzer', 'dinan', 'vorsteiner', 'hre', 
              'adv_1', 'forgiato', 'vossen', 'rohana', 'titan7', 'volk', 'work', 'rays', 
              'enkei', 'bbs', 'oz', 'ssr', 'weds', 'gram_lights', 'volk_racing', 
              'work_emotion', 'volk_te37', 'volk_ce28', 'volk_re30', 'volk_gt_c', 
              'volk_gt_n', 'volk_gt_v', 'volk_gt_u', 'volk_gt_f', 'volk_gt_m', 'volk_gt_s', 
              'volk_gt_t', 'volk_gt_w', 'volk_gt_x', 'volk_gt_y', 'volk_gt_z'
            ];
            makes.forEach(makeKey => {
              const option = document.createElement('option');
              option.value = makeKey;
              option.textContent = makeKey.toUpperCase().replace('_', ' ');
              select.appendChild(option);
            });
          }
        });

        // Populate car models dropdown
        const modelSelects = document.querySelectorAll('select[name="model_name"]');
        modelSelects.forEach(select => {
          if (select.children.length <= 1) { // Only has "Select Model" option
            const models = [
              'bmw_3_series', 'bmw_5_series', 'bmw_7_series', 'bmw_x3', 'bmw_x5', 'bmw_x7', 
              'bmw_z4', 'bmw_m3', 'bmw_m5', 'bmw_m8', 'mercedes_c_class', 'mercedes_e_class', 
              'mercedes_s_class', 'mercedes_gla', 'mercedes_glc', 'mercedes_gle', 'mercedes_gls', 
              'mercedes_amg_gt', 'audi_a3', 'audi_a4', 'audi_a6', 'audi_a8', 'audi_q3', 
              'audi_q5', 'audi_q7', 'audi_q8', 'audi_rs6', 'audi_rs7', 'volkswagen_golf', 
              'volkswagen_passat', 'volkswagen_tiguan', 'volkswagen_atlas', 'volkswagen_id4', 
              'toyota_camry', 'toyota_corolla', 'toyota_rav4', 'toyota_highlander', 'toyota_prius', 
              'honda_civic', 'honda_accord', 'honda_crv', 'honda_pilot', 'ford_focus', 'ford_fusion', 
              'ford_escape', 'ford_explorer', 'chevrolet_cruze', 'chevrolet_malibu', 'chevrolet_equinox', 
              'chevrolet_tahoe', 'nissan_sentra', 'nissan_altima', 'nissan_rogue', 'nissan_murano', 
              'hyundai_elantra', 'hyundai_sonata', 'hyundai_tucson', 'hyundai_santa_fe', 'kia_forte', 
              'kia_optima', 'kia_sportage', 'kia_sorento', 'mazda_3', 'mazda_6', 'mazda_cx5', 
              'mazda_cx9', 'subaru_impreza', 'subaru_legacy', 'subaru_forester', 'subaru_outback', 
              'volvo_s60', 'volvo_s90', 'volvo_xc40', 'volvo_xc60', 'volvo_xc90', 'lexus_es', 
              'lexus_ls', 'lexus_rx', 'lexus_nx', 'lexus_gx', 'lexus_lx', 'infiniti_q50', 
              'infiniti_q70', 'infiniti_qx50', 'infiniti_qx60', 'acura_tlx', 'acura_rlx', 
              'acura_rdx', 'acura_mdx', 'buick_regal', 'buick_lacrosse', 'buick_encore', 
              'buick_enclave', 'cadillac_cts', 'cadillac_ct6', 'cadillac_xt4', 'cadillac_xt5', 
              'cadillac_escalade', 'chrysler_300', 'chrysler_pacifica', 'dodge_charger', 
              'dodge_challenger', 'dodge_durango', 'jeep_cherokee', 'jeep_grand_cherokee', 
              'jeep_wrangler', 'ram_1500', 'ram_2500', 'ram_3500', 'gmc_terrain', 'gmc_acadia', 
              'gmc_yukon', 'tesla_model_3', 'tesla_model_s', 'tesla_model_x', 'tesla_model_y', 
              'ferrari_f8', 'ferrari_sf90', 'ferrari_roma', 'lamborghini_huracan', 'lamborghini_aventador', 
              'lamborghini_urus', 'porsche_911', 'porsche_cayenne', 'porsche_macan', 'maserati_ghibli', 
              'maserati_quattroporte', 'maserati_levante', 'aston_martin_db11', 'aston_martin_vantage', 
              'aston_martin_dbs', 'bentley_continental', 'bentley_flying_spur', 'bentley_bentayga', 
              'rolls_royce_phantom', 'rolls_royce_ghost', 'rolls_royce_cullinan', 'mclaren_720s', 
              'mclaren_765lt', 'mclaren_artura', 'bugatti_chiron', 'bugatti_veyron', 'koenigsegg_jesko', 
              'koenigsegg_regera', 'pagani_huayra', 'pagani_zonda', 'rimac_nevera', 'lotus_emira', 
              'lotus_evija', 'alpine_a110', 'caterham_7', 'ariel_atom', 'noble_m600', 'radical_sr3', 
              'ultima_evo', 'zenvo_ts1', 'gumpert_apollo', 'saleen_s7', 'hennessey_venom', 
              'callaway_corvette', 'ruf_ctr', 'techart_gt_street', 'mansory_mercedes', 'brabus_mercedes', 
              'alpina_bmw', 'hamann_bmw', 'hartge_bmw', 'ac_schnitzer_bmw', 'dinan_bmw', 'vorsteiner_bmw', 
              'hre_wheels', 'adv_1_wheels', 'forgiato_wheels', 'vossen_wheels', 'rohana_wheels', 
              'titan7_wheels', 'volk_wheels', 'work_wheels', 'rays_wheels', 'enkei_wheels', 
              'bbs_wheels', 'oz_wheels', 'ssr_wheels', 'weds_wheels', 'gram_lights_wheels', 
              'volk_racing_wheels', 'work_emotion_wheels', 'volk_te37_wheels', 'volk_ce28_wheels', 
              'volk_re30_wheels', 'volk_gt_c_wheels', 'volk_gt_n_wheels', 'volk_gt_v_wheels', 
              'volk_gt_u_wheels', 'volk_gt_f_wheels', 'volk_gt_m_wheels', 'volk_gt_s_wheels', 
              'volk_gt_t_wheels', 'volk_gt_w_wheels', 'volk_gt_x_wheels', 'volk_gt_y_wheels', 
              'volk_gt_z_wheels'
            ];
            models.forEach(modelKey => {
              const option = document.createElement('option');
              option.value = modelKey;
              option.textContent = modelKey.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
              select.appendChild(option);
            });
          }
        });

        // Populate exterior colors dropdown
        const exteriorColorSelects = document.querySelectorAll('select[name="exterior_color"]');
        exteriorColorSelects.forEach(select => {
          if (select.children.length <= 1) { // Only has "Select Exterior Color" option
            const colors = [
              'white', 'black', 'silver', 'gray', 'red', 'blue', 'green', 'yellow', 'orange', 
              'purple', 'brown', 'beige', 'gold', 'bronze', 'copper', 'chrome', 'matte_black', 
              'matte_white', 'matte_gray', 'matte_red', 'matte_blue', 'matte_green', 'matte_yellow', 
              'matte_orange', 'matte_purple', 'matte_brown', 'matte_beige', 'matte_gold', 
              'matte_bronze', 'matte_copper', 'matte_chrome', 'pearl_white', 'pearl_black', 
              'pearl_silver', 'pearl_gray', 'pearl_red', 'pearl_blue', 'pearl_green', 'pearl_yellow', 
              'pearl_orange', 'pearl_purple', 'pearl_brown', 'pearl_beige', 'pearl_gold', 
              'pearl_bronze', 'pearl_copper', 'pearl_chrome', 'metallic_white', 'metallic_black', 
              'metallic_silver', 'metallic_gray', 'metallic_red', 'metallic_blue', 'metallic_green', 
              'metallic_yellow', 'metallic_orange', 'metallic_purple', 'metallic_brown', 'metallic_beige', 
              'metallic_gold', 'metallic_bronze', 'metallic_copper', 'metallic_chrome', 'candy_white', 
              'candy_black', 'candy_silver', 'candy_gray', 'candy_red', 'candy_blue', 'candy_green', 
              'candy_yellow', 'candy_orange', 'candy_purple', 'candy_brown', 'candy_beige', 'candy_gold', 
              'candy_bronze', 'candy_copper', 'candy_chrome', 'chameleon_white', 'chameleon_black', 
              'chameleon_silver', 'chameleon_gray', 'chameleon_red', 'chameleon_blue', 'chameleon_green', 
              'chameleon_yellow', 'chameleon_orange', 'chameleon_purple', 'chameleon_brown', 'chameleon_beige', 
              'chameleon_gold', 'chameleon_bronze', 'chameleon_copper', 'chameleon_chrome'
            ];
            colors.forEach(colorKey => {
              const option = document.createElement('option');
              option.value = colorKey;
              option.textContent = colorKey.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
              select.appendChild(option);
            });
          }
        });

        // Populate interior colors dropdown
        const interiorColorSelects = document.querySelectorAll('select[name="interior_color"]');
        interiorColorSelects.forEach(select => {
          if (select.children.length <= 1) { // Only has "Select Interior Color" option
            const colors = [
              'white', 'black', 'silver', 'gray', 'red', 'blue', 'green', 'yellow', 'orange', 
              'purple', 'brown', 'beige', 'gold', 'bronze', 'copper', 'chrome', 'matte_black', 
              'matte_white', 'matte_gray', 'matte_red', 'matte_blue', 'matte_green', 'matte_yellow', 
              'matte_orange', 'matte_purple', 'matte_brown', 'matte_beige', 'matte_gold', 
              'matte_bronze', 'matte_copper', 'matte_chrome', 'pearl_white', 'pearl_black', 
              'pearl_silver', 'pearl_gray', 'pearl_red', 'pearl_blue', 'pearl_green', 'pearl_yellow', 
              'pearl_orange', 'pearl_purple', 'pearl_brown', 'pearl_beige', 'pearl_gold', 
              'pearl_bronze', 'pearl_copper', 'pearl_chrome', 'metallic_white', 'metallic_black', 
              'metallic_silver', 'metallic_gray', 'metallic_red', 'metallic_blue', 'metallic_green', 
              'metallic_yellow', 'metallic_orange', 'metallic_purple', 'metallic_brown', 'metallic_beige', 
              'metallic_gold', 'metallic_bronze', 'metallic_copper', 'metallic_chrome', 'candy_white', 
              'candy_black', 'candy_silver', 'candy_gray', 'candy_red', 'candy_blue', 'candy_green', 
              'candy_yellow', 'candy_orange', 'candy_purple', 'candy_brown', 'candy_beige', 'candy_gold', 
              'candy_bronze', 'candy_copper', 'candy_chrome', 'chameleon_white', 'chameleon_black', 
              'chameleon_silver', 'chameleon_gray', 'chameleon_red', 'chameleon_blue', 'chameleon_green', 
              'chameleon_yellow', 'chameleon_orange', 'chameleon_purple', 'chameleon_brown', 'chameleon_beige', 
              'chameleon_gold', 'chameleon_bronze', 'chameleon_copper', 'chameleon_chrome'
            ];
            colors.forEach(colorKey => {
              const option = document.createElement('option');
              option.value = colorKey;
              option.textContent = colorKey.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
              select.appendChild(option);
            });
          }
        });
      }

      // Call populateDropdowns on page load
      populateDropdowns();

      // Add Car Button
      const showAddCarBtn = document.getElementById('showAddCarBtn');
      const addCarPanel = document.getElementById('addCarPanel');
      const closeAddCarPanel = document.getElementById('closeAddCarPanel');
      const adminOverlay = document.getElementById('adminOverlay');
      
      if (showAddCarBtn) {
        showAddCarBtn.addEventListener('click', () => {
          addCarPanel.classList.add('active');
          adminOverlay.classList.add('active');
          document.body.classList.add('admin-popup-open');
        });
      }
      
      if (closeAddCarPanel) {
        closeAddCarPanel.addEventListener('click', () => {
          addCarPanel.classList.remove('active');
          adminOverlay.classList.remove('active');
          document.body.classList.remove('admin-popup-open');
        });
      }
      
      // Close modal when clicking overlay
      if (adminOverlay) {
        adminOverlay.addEventListener('click', () => {
          addCarPanel.classList.remove('active');
          editCarPanel.classList.remove('active');
          adminOverlay.classList.remove('active');
          document.body.classList.remove('admin-popup-open');
        });
      }
      
      // Edit Car Panel functionality
      const editCarPanel = document.getElementById('editCarPanel');
      const closeEditCarPanel = document.getElementById('closeEditCarPanel');
      

      
      if (closeEditCarPanel) {
        closeEditCarPanel.addEventListener('click', () => {
          editCarPanel.classList.remove('active');
          adminOverlay.classList.remove('active');
          document.body.classList.remove('admin-popup-open');
        });
      }
      
      // Edit Car Form Submit
      const editCarForm = document.getElementById('editCarForm');
      if (editCarForm) {
        editCarForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          
          const carId = editCarForm.dataset.carId;
          if (!carId) {
            showCustomAlert('Error: Car ID not found', 'error');
            return;
          }
          
          const formData = new FormData(editCarForm);
          const carData = Object.fromEntries(formData.entries());
          
          // Convert price fields to price_policy object
          const pricePolicy = {
            '1-2': carData.price_1_2 || '',
            '3-7': carData.price_3_7 || '',
            '8-20': carData.price_8_20 || '',
            '21-45': carData.price_21_45 || '',
            '46+': carData.price_46 || ''
          };
          
          // Remove individual price fields and add price_policy
          delete carData.price_1_2;
          delete carData.price_3_7;
          delete carData.price_8_20;
          delete carData.price_21_45;
          delete carData.price_46;
          carData.price_policy = pricePolicy;
          
          // Ensure all required fields are present
          carData.make_name = carData.make_name || '';
          carData.model_name = carData.model_name || '';
          carData.production_year = carData.production_year || '';
          carData.gear_type = carData.gear_type || '';
          carData.fuel_type = carData.fuel_type || '';
          carData.car_type = carData.car_type || '';
          carData.num_doors = carData.num_doors || '';
          carData.num_passengers = carData.num_passengers || '';
          carData.rca_insurance_price = carData.rca_insurance_price || '';
          carData.casco_insurance_price = carData.casco_insurance_price || '';
          
          // Handle engine_capacity for electric cars
          if (carData.fuel_type === 'Electric') {
            carData.engine_capacity = null;
          } else {
            carData.engine_capacity = carData.engine_capacity || '';
          }
          
          // Handle image uploads if files are selected
          const headImageFile = document.getElementById('editHeadImageInput').files[0];
          const galleryImageFiles = Array.from(document.getElementById('editGalleryImagesInput').files);
          
          if (headImageFile || galleryImageFiles.length > 0) {
            const imageFormData = new FormData();
            
            // Add all form data
            Object.keys(carData).forEach(key => {
              if (key === 'price_policy') {
                imageFormData.append(key, JSON.stringify(carData[key]));
              } else {
                imageFormData.append(key, carData[key]);
              }
            });
            
            // Add images
            if (headImageFile) {
              imageFormData.append('head_image', headImageFile);
            }
            galleryImageFiles.forEach(file => {
              imageFormData.append('gallery_images', file);
            });
            
            try {
              const response = await fetch(`${window.API_BASE_URL}/api/cars/${carId}`, {
                method: 'PUT',
                body: imageFormData
              });
              
              if (response.ok) {
                showCustomAlert('Car updated successfully!', 'success');
                editCarForm.reset();
                editCarPanel.classList.remove('active');
                adminOverlay.classList.remove('active');
                document.body.classList.remove('admin-popup-open');
                loadCars();
              } else {
                const error = await response.json();
                let errorMessage = 'Error updating car: ' + error.error;
                if (error.missingFields && error.missingFields.length > 0) {
                  errorMessage += '\n\nMissing fields:\n• ' + error.missingFields.join('\n• ');
                }
                showCustomAlert(errorMessage, 'error');
              }
            } catch (error) {
              console.error('Error updating car:', error);
              showCustomAlert('Error updating car', 'error');
            }
          } else {
            // No images to upload, use JSON
            try {
              const response = await fetch(`${window.API_BASE_URL}/api/cars/${carId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(carData)
              });
              
              if (response.ok) {
                showCustomAlert('Car updated successfully!', 'success');
                editCarForm.reset();
                editCarPanel.classList.remove('active');
                adminOverlay.classList.remove('active');
                document.body.classList.remove('admin-popup-open');
                loadCars();
              } else {
                const error = await response.json();
                let errorMessage = 'Error updating car: ' + error.error;
                if (error.missingFields && error.missingFields.length > 0) {
                  errorMessage += '\n\nMissing fields:\n• ' + error.missingFields.join('\n• ');
                }
                showCustomAlert(errorMessage, 'error');
              }
            } catch (error) {
              console.error('Error updating car:', error);
              showCustomAlert('Error updating car', 'error');
            }
          }
        });
      }
      
      // Delete Car Button functionality
      const deleteCarBtn = document.getElementById('deleteCarBtn');
      if (deleteCarBtn) {
        deleteCarBtn.addEventListener('click', async () => {
          const carId = editCarForm.dataset.carId;
          if (!carId) {
            showCustomAlert('Error: Car ID not found', 'error');
            return;
          }
          
          if (confirm('Are you sure you want to delete this car? This action cannot be undone.')) {
            try {
              const response = await fetch(`${window.API_BASE_URL}/api/cars/${carId}`, {
                method: 'DELETE'
              });
              
              if (response.ok) {
                showCustomAlert('Car deleted successfully!', 'success');
                editCarPanel.classList.remove('active');
                adminOverlay.classList.remove('active');
                document.body.classList.remove('admin-popup-open');
                loadCars();
              } else {
                const error = await response.json();
                showCustomAlert('Error deleting car: ' + error.error, 'error');
              }
            } catch (error) {
              console.error('Error deleting car:', error);
              showCustomAlert('Error deleting car', 'error');
            }
          }
        });
      }
      
      // Image Upload Functionality
      initializeImageUploads();
    }
    
    function initializeImageUploads() {
      // Add Car Image Uploads
      const addHeadImageButton = document.getElementById('addHeadImageButton');
      const addHeadImageInput = document.getElementById('addHeadImageInput');
      const addHeadImagePreview = document.getElementById('addHeadImagePreview');
      
      if (addHeadImageButton && addHeadImageInput) {
        addHeadImageButton.addEventListener('click', () => addHeadImageInput.click());
        addHeadImageInput.addEventListener('change', (e) => {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
              addHeadImagePreview.innerHTML = `
                <div style="position: relative; display: inline-block;">
                  <img src="${e.target.result}" alt="Head image preview" style="max-width: 200px; max-height: 150px; border-radius: 4px;">
                  <button type="button" class="btn btn-danger btn-sm" style="position: absolute; top: -8px; right: -8px; border-radius: 50%; width: 24px; height: 24px; padding: 0; font-size: 12px;" onclick="this.parentElement.remove()">×</button>
                </div>
              `;
            };
            reader.readAsDataURL(file);
          }
        });
      }
      
      const addGalleryImagesButton = document.getElementById('addGalleryImagesButton');
      const addGalleryImagesInput = document.getElementById('addGalleryImagesInput');
      const addGalleryImagesPreview = document.getElementById('addGalleryImagesPreview');
      
      if (addGalleryImagesButton && addGalleryImagesInput) {
        addGalleryImagesButton.addEventListener('click', () => addGalleryImagesInput.click());
        addGalleryImagesInput.addEventListener('change', (e) => {
          const files = Array.from(e.target.files);
          files.forEach(file => {
            const reader = new FileReader();
            reader.onload = (e) => {
              addGalleryImagesPreview.innerHTML += `
                <div style="position: relative; display: inline-block; margin: 5px;">
                  <img src="${e.target.result}" alt="Gallery image preview" style="max-width: 100px; max-height: 75px; border-radius: 4px;">
                  <button type="button" class="btn btn-danger btn-sm" style="position: absolute; top: -8px; right: -8px; border-radius: 50%; width: 24px; height: 24px; padding: 0; font-size: 12px;" onclick="this.parentElement.remove()">×</button>
                </div>
              `;
            };
            reader.readAsDataURL(file);
          });
        });
      }
      
      // Edit Car Image Uploads
      const editHeadImageButton = document.getElementById('editHeadImageButton');
      const editHeadImageInput = document.getElementById('editHeadImageInput');
      const editHeadImagePreview = document.getElementById('editHeadImagePreview');
      
      if (editHeadImageButton && editHeadImageInput) {
        editHeadImageButton.addEventListener('click', () => editHeadImageInput.click());
        editHeadImageInput.addEventListener('change', (e) => {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
              editHeadImagePreview.innerHTML = `
                <img src="${e.target.result}" alt="Head image preview" style="max-width: 200px; max-height: 150px; border-radius: 4px;">
              `;
            };
            reader.readAsDataURL(file);
          }
        });
      }
      
      const editGalleryImagesButton = document.getElementById('editGalleryImagesButton');
      const editGalleryImagesInput = document.getElementById('editGalleryImagesInput');
      const editGalleryImagesPreview = document.getElementById('editGalleryImagesPreview');
      
      if (editGalleryImagesButton && editGalleryImagesInput) {
        editGalleryImagesButton.addEventListener('click', () => editGalleryImagesInput.click());
        editGalleryImagesInput.addEventListener('change', (e) => {
          const files = Array.from(e.target.files);
          files.forEach(file => {
            const reader = new FileReader();
            reader.onload = (e) => {
              editGalleryImagesPreview.innerHTML += `
                <div style="position: relative; display: inline-block; margin: 5px;">
                  <img src="${e.target.result}" alt="Gallery image preview" style="max-width: 100px; max-height: 75px; border-radius: 4px;">
                  <button type="button" class="btn btn-danger btn-sm" style="position: absolute; top: -8px; right: -8px; border-radius: 50%; width: 24px; height: 24px; padding: 0; font-size: 12px;" onclick="this.parentElement.remove()">×</button>
                </div>
              `;
            };
            reader.readAsDataURL(file);
          });
        });
      }
      
      // Image removal functions
      window.removeHeadImage = function() {
        const editHeadImagePreview = document.getElementById('editHeadImagePreview');
        if (editHeadImagePreview) {
          editHeadImagePreview.innerHTML = '';
        }
      };
      
      window.removeGalleryImage = function(index) {
        const editGalleryImagesPreview = document.getElementById('editGalleryImagesPreview');
        if (editGalleryImagesPreview) {
          const images = editGalleryImagesPreview.querySelectorAll('div');
          if (images[index]) {
            images[index].remove();
          }
        }
      };
      
      // Car Form Submit
      const carForm = document.getElementById('carForm');
      if (carForm) {
        carForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          
          const formData = new FormData(carForm);
          const carData = Object.fromEntries(formData.entries());
          
          // Convert price fields to price_policy object
          const pricePolicy = {
            '1-2': carData.price_1_2 || '',
            '3-7': carData.price_3_7 || '',
            '8-20': carData.price_8_20 || '',
            '21-45': carData.price_21_45 || '',
            '46+': carData.price_46 || ''
          };
          
          // Remove individual price fields and add price_policy
          delete carData.price_1_2;
          delete carData.price_3_7;
          delete carData.price_8_20;
          delete carData.price_21_45;
          delete carData.price_46;
          carData.price_policy = pricePolicy;
          
          // Ensure all required fields are present
          carData.make_name = carData.make_name || '';
          carData.model_name = carData.model_name || '';
          carData.production_year = carData.production_year || '';
          carData.gear_type = carData.gear_type || '';
          carData.fuel_type = carData.fuel_type || '';
          carData.car_type = carData.car_type || '';
          carData.num_doors = carData.num_doors || '';
          carData.num_passengers = carData.num_passengers || '';
          carData.rca_insurance_price = carData.rca_insurance_price || '';
          carData.casco_insurance_price = carData.casco_insurance_price || '';
          
          // Handle engine_capacity for electric cars
          if (carData.fuel_type === 'Electric') {
            carData.engine_capacity = null;
          } else {
            carData.engine_capacity = carData.engine_capacity || '';
          }
          
                  // Convert display text back to raw keys for backend processing
        if (carData.make_name && carData.make_name !== '') {
          // Check if we have a stored raw value first
          const makeInput = document.getElementById('add_make_name');
          if (makeInput && makeInput.dataset.rawValue) {
            carData.make_name = makeInput.dataset.rawValue;
          } else {
          const makeKeys = {
            'BMW': 'bmw',
            'MERCEDES': 'mercedes',
            'AUDI': 'audi',
            'VOLKSWAGEN': 'volkswagen',
            'TOYOTA': 'toyota',
            'HONDA': 'honda',
            'FORD': 'ford',
            'CHEVROLET': 'chevrolet',
            'NISSAN': 'nissan',
            'HYUNDAI': 'hyundai',
            'KIA': 'kia',
            'MAZDA': 'mazda',
            'SUBARU': 'subaru',
            'MITSUBISHI': 'mitsubishi',
            'LEXUS': 'lexus',
            'INFINITI': 'infiniti',
            'ACURA': 'acura',
            'BUICK': 'buick',
            'CADILLAC': 'cadillac',
            'CHRYSLER': 'chrysler',
            'DODGE': 'dodge',
            'JEEP': 'jeep',
            'RAM': 'ram',
            'GMC': 'gmc',
            'PONTIAC': 'pontiac',
            'SATURN': 'saturn',
            'SCION': 'scion',
            'VOLVO': 'volvo',
            'SAAB': 'saab',
            'ALFA ROMEO': 'alfa_romeo',
            'FIAT': 'fiat',
            'LANCIA': 'lancia',
            'MASERATI': 'maserati',
            'FERRARI': 'ferrari',
            'LAMBORGHINI': 'lamborghini',
            'BENTLEY': 'bentley',
            'ROLLS ROYCE': 'rolls_royce',
            'ASTON MARTIN': 'aston_martin',
            'MCLAREN': 'mclaren',
            'LOTUS': 'lotus',
            'JAGUAR': 'jaguar',
            'LAND ROVER': 'land_rover',
            'MINI': 'mini',
            'SMART': 'smart',
            'OPEL': 'opel',
            'PEUGEOT': 'peugeot',
            'RENAULT': 'renault',
            'CITROEN': 'citroen',
            'SEAT': 'seat',
            'SKODA': 'skoda'
          };
          carData.make_name = makeKeys[carData.make_name] || carData.make_name;
          }
        }
        if (carData.model_name && carData.model_name !== '') {
          // Check if we have a stored raw value first
          const modelInput = document.getElementById('add_model_name');
          if (modelInput && modelInput.dataset.rawValue) {
            carData.model_name = modelInput.dataset.rawValue;
          } else {
          const modelKeys = {
            '3 Series': '3_series',
            '5 Series': '5_series',
            'X3': 'x3',
            'X5': 'x5',
            'X7': 'x7',
            'C Class': 'c_class',
            'E Class': 'e_class',
            'S Class': 's_class',
            'GLC': 'glc',
            'GLE': 'gle',
            'A3': 'a3',
            'A4': 'a4',
            'A6': 'a6',
            'Q3': 'q3',
            'Q5': 'q5',
            'Q7': 'q7',
            'Golf': 'golf',
            'Passat': 'passat',
            'Tiguan': 'tiguan',
            'Touareg': 'touareg',
            'Camry': 'camry',
            'Corolla': 'corolla',
            'RAV4': 'rav4',
            'Highlander': 'highlander',
            'Civic': 'civic',
            'Accord': 'accord',
            'CR-V': 'cr_v',
            'Pilot': 'pilot',
            'Focus': 'focus',
            'Fusion': 'fusion',
            'Escape': 'escape',
            'Explorer': 'explorer',
            'Cruze': 'cruze',
            'Malibu': 'malibu',
            'Equinox': 'equinox',
            'Traverse': 'traverse',
            'Altima': 'altima',
            'Maxima': 'maxima',
            'Rogue': 'rogue',
            'Murano': 'murano',
            'Elantra': 'elantra',
            'Sonata': 'sonata',
            'Tucson': 'tucson',
            'Santa Fe': 'santa_fe',
            'Forte': 'forte',
            'Optima': 'optima',
            'Sportage': 'sportage',
            'Sorento': 'sorento',
            'Mazda3': 'mazda3',
            'Mazda6': 'mazda6',
            'CX-5': 'cx_5',
            'CX-9': 'cx_9',
            'Impreza': 'impreza',
            'Legacy': 'legacy',
            'Forester': 'forester',
            'Outback': 'outback',
            'Lancer': 'lancer',
            'Outlander': 'outlander',
            'ES': 'es',
            'IS': 'is',
            'RX': 'rx',
            'NX': 'nx',
            'Q50': 'q50',
            'Q70': 'q70',
            'QX50': 'qx50',
            'QX60': 'qx60',
            'TLX': 'tlx',
            'RLX': 'rlx',
            'RDX': 'rdx',
            'MDX': 'mdx',
            'LaCrosse': 'lacrosse',
            'Enclave': 'enclave',
            'ATS': 'ats',
            'CTS': 'cts',
            'XT5': 'xt5',
            'Escalade': 'escalade',
            '300': '300',
            'Charger': 'charger',
            'Challenger': 'challenger',
            'Grand Cherokee': 'grand_cherokee',
            'Wrangler': 'wrangler',
            '1500': '1500',
            'Acadia': 'acadia',
            'Yukon': 'yukon',
            'G6': 'g6',
            'Aura': 'aura',
            'tC': 'tc',
            'S60': 's60',
            'S90': 's90',
            'XC60': 'xc60',
            'XC90': 'xc90',
            '9-3': '9_3',
            '9-5': '9_5',
            'Giulia': 'giulia',
            'Stelvio': 'stelvio',
            '500': '500',
            'Delta': 'delta',
            'Ghibli': 'ghibli',
            'Levante': 'levante',
            '488': '488',
            'F8': 'f8',
            'Huracan': 'huracan',
            'Aventador': 'aventador',
            'Continental': 'continental',
            'Flying Spur': 'flying_spur',
            'Phantom': 'phantom',
            'Ghost': 'ghost',
            'DB11': 'db11',
            'Vantage': 'vantage',
            '720S': '720s',
            '570S': '570s',
            'Elise': 'elise',
            'Evora': 'evora',
            'XE': 'xe',
            'XF': 'xf',
            'F-Pace': 'f_pace',
            'Range Rover': 'range_rover',
            'Discovery': 'discovery',
            'Cooper': 'cooper',
            'Countryman': 'countryman',
            'Fortwo': 'fortwo',
            'Astra': 'astra',
            'Insignia': 'insignia',
            '308': '308',
            '508': '508',
            'Clio': 'clio',
            'Megane': 'megane',
            'C3': 'c3',
            'C5': 'c5',
            'Leon': 'leon',
            'Ibiza': 'ibiza',
            'Octavia': 'octavia',
            'Superb': 'superb'
          };
          carData.model_name = modelKeys[carData.model_name] || carData.model_name;
          }
        }
        if (carData.exterior_color && carData.exterior_color !== '') {
          // Check if we have a stored raw value first
          const exteriorColorInput = document.getElementById('add_exterior_color');
          if (exteriorColorInput && exteriorColorInput.dataset.rawValue) {
            carData.exterior_color = exteriorColorInput.dataset.rawValue;
          } else {
          const colorKeys = {
            'White': 'white',
            'Black': 'black',
            'Silver': 'silver',
            'Gray': 'gray',
            'Red': 'red',
            'Blue': 'blue',
            'Green': 'green',
            'Yellow': 'yellow',
            'Orange': 'orange',
            'Purple': 'purple',
            'Pink': 'pink',
            'Brown': 'brown',
            'Beige': 'beige',
            'Gold': 'gold',
            'Bronze': 'bronze',
            'Pearl White': 'pearl_white',
            'Metallic Black': 'metallic_black',
            'Metallic Silver': 'metallic_silver',
            'Metallic Gray': 'metallic_gray',
            'Metallic Red': 'metallic_red',
            'Metallic Blue': 'metallic_blue',
            'Metallic Green': 'metallic_green',
            'Metallic Yellow': 'metallic_yellow',
            'Metallic Orange': 'metallic_orange',
            'Metallic Purple': 'metallic_purple',
            'Metallic Pink': 'metallic_pink',
            'Metallic Brown': 'metallic_brown',
            'Metallic Beige': 'metallic_beige',
            'Metallic Gold': 'metallic_gold',
            'Metallic Bronze': 'metallic_bronze'
          };
          carData.exterior_color = colorKeys[carData.exterior_color] || carData.exterior_color;
          }
        }
        if (carData.interior_color && carData.interior_color !== '') {
          // Check if we have a stored raw value first
          const interiorColorInput = document.getElementById('add_interior_color');
          if (interiorColorInput && interiorColorInput.dataset.rawValue) {
            carData.interior_color = interiorColorInput.dataset.rawValue;
          } else {
            carData.interior_color = colorKeys[carData.interior_color] || carData.interior_color;
          }
        }
          
          // Handle image uploads if files are selected
          const headImageFile = document.getElementById('addHeadImageInput').files[0];
          const galleryImageFiles = Array.from(document.getElementById('addGalleryImagesInput').files);
          
          if (headImageFile || galleryImageFiles.length > 0) {
            const imageFormData = new FormData();
            
            // Add all form data
            Object.keys(carData).forEach(key => {
              if (key === 'price_policy') {
                imageFormData.append(key, JSON.stringify(carData[key]));
              } else {
                imageFormData.append(key, carData[key]);
              }
            });
            
            // Add images
            if (headImageFile) {
              imageFormData.append('head_image', headImageFile);
            }
            galleryImageFiles.forEach(file => {
              imageFormData.append('gallery_images', file);
            });
            
            try {
              const response = await fetch(`${window.API_BASE_URL}/api/cars`, {
                method: 'POST',
                body: imageFormData
              });
              
              if (response.ok) {
                showCustomAlert('Car added successfully!', 'success');
                carForm.reset();
                addCarPanel.classList.remove('active');
                adminOverlay.classList.remove('active');
                document.body.classList.remove('admin-popup-open');
                loadCars();
              } else {
                const error = await response.json();
                let errorMessage = 'Error adding car: ' + error.error;
                if (error.missingFields && error.missingFields.length > 0) {
                  errorMessage += '\n\nMissing fields:\n• ' + error.missingFields.join('\n• ');
                }
                showCustomAlert(errorMessage, 'error');
              }
            } catch (error) {
              console.error('Error adding car:', error);
              showCustomAlert('Error adding car', 'error');
            }
          } else {
            // No images to upload, use JSON
            try {
              const response = await fetch(`${window.API_BASE_URL}/api/cars`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(carData)
              });
              
              if (response.ok) {
                showCustomAlert('Car added successfully!', 'success');
                carForm.reset();
                addCarPanel.classList.remove('active');
                adminOverlay.classList.remove('active');
                document.body.classList.remove('admin-popup-open');
                loadCars();
              } else {
                const error = await response.json();
                let errorMessage = 'Error adding car: ' + error.error;
                if (error.missingFields && error.missingFields.length > 0) {
                  errorMessage += '\n\nMissing fields:\n• ' + error.missingFields.join('\n• ');
                }
                showCustomAlert(errorMessage, 'error');
              }
            } catch (error) {
              console.error('Error adding car:', error);
              showCustomAlert('Error adding car', 'error');
            }
          }
        });
      }
    }

    function initializeCouponForms() {
      // Add Coupon Button
      const showAddCouponBtn = document.getElementById('showAddCouponBtn');
      const addCouponPanel = document.getElementById('addCouponPanel');
      const closeAddCouponPanel = document.getElementById('closeAddCouponPanel');
      const couponOverlay = document.getElementById('couponOverlay');
      
      if (showAddCouponBtn) {
        showAddCouponBtn.addEventListener('click', () => {
          addCouponPanel.classList.add('active');
          couponOverlay.classList.add('active');
          document.body.classList.add('admin-popup-open');
        });
      }
      
      if (closeAddCouponPanel) {
        closeAddCouponPanel.addEventListener('click', () => {
          addCouponPanel.classList.remove('active');
          couponOverlay.classList.remove('active');
          document.body.classList.remove('admin-popup-open');
        });
      }
      
      // Close modal when clicking overlay
      if (couponOverlay) {
        couponOverlay.addEventListener('click', () => {
          addCouponPanel.classList.remove('active');
          couponOverlay.classList.remove('active');
          document.body.classList.remove('admin-popup-open');
        });
      }
      
      // Coupon Form Submit
      const couponForm = document.getElementById('couponForm');
      if (couponForm) {
        couponForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          
          const formData = new FormData(couponForm);
          const couponData = Object.fromEntries(formData.entries());
          
          try {
            const response = await fetch(`${window.API_BASE_URL}/api/coupons`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(couponData)
            });
            
            if (response.ok) {
              showCustomAlert('Coupon added successfully!', 'success');
              couponForm.reset();
              addCouponPanel.classList.remove('active');
              couponOverlay.classList.remove('active');
              document.body.classList.remove('admin-popup-open');
              loadCoupons();
            } else {
              const error = await response.json();
              showCustomAlert('Error adding coupon: ' + error.error, 'error');
            }
          } catch (error) {
            console.error('Error adding coupon:', error);
            showCustomAlert('Error adding coupon', 'error');
          }
        });
      }
    }

    // Edit and Delete Functions
    async function editCar(carId) {
      try {
        const response = await fetch(`${window.API_BASE_URL}/api/cars/${carId}`);
        const car = await response.json();
        
        if (!response.ok) {
          showCustomAlert('Error loading car data: ' + car.error, 'error');
          return;
        }
        
        // Populate the edit form with car data
        const editForm = document.getElementById('editCarForm');
        if (!editForm) return;
        
        // Fill in all the form fields
        const makeInput = editForm.querySelector('input[name="make_name"]');
        const modelInput = editForm.querySelector('input[name="model_name"]');
        const productionYearSelect = editForm.querySelector('select[name="production_year"]');
        const gearTypeSelect = editForm.querySelector('select[name="gear_type"]');
        const fuelTypeSelect = editForm.querySelector('select[name="fuel_type"]');
        const engineCapacityInput = editForm.querySelector('input[name="engine_capacity"]');
        const carTypeSelect = editForm.querySelector('select[name="car_type"]');
        const numDoorsSelect = editForm.querySelector('select[name="num_doors"]');
        const numPassengersSelect = editForm.querySelector('select[name="num_passengers"]');
        
        if (makeInput) makeInput.value = car.make_name || '';
        if (modelInput) modelInput.value = car.model_name || '';
        if (productionYearSelect) productionYearSelect.value = car.production_year || '';
        if (gearTypeSelect) gearTypeSelect.value = car.gear_type || '';
        if (fuelTypeSelect) fuelTypeSelect.value = car.fuel_type || '';
        if (engineCapacityInput) engineCapacityInput.value = car.engine_capacity || '';
        if (carTypeSelect) carTypeSelect.value = car.car_type || '';
        if (numDoorsSelect) numDoorsSelect.value = car.num_doors || '';
        if (numPassengersSelect) numPassengersSelect.value = car.num_passengers || '';
        
        // Fill in price policy fields
        if (car.price_policy) {
          const price1_2Input = editForm.querySelector('input[name="price_1_2"]');
          const price3_7Input = editForm.querySelector('input[name="price_3_7"]');
          const price8_20Input = editForm.querySelector('input[name="price_8_20"]');
          const price21_45Input = editForm.querySelector('input[name="price_21_45"]');
          const price46Input = editForm.querySelector('input[name="price_46"]');
          
          if (price1_2Input) price1_2Input.value = car.price_policy['1-2'] || '';
          if (price3_7Input) price3_7Input.value = car.price_policy['3-7'] || '';
          if (price8_20Input) price8_20Input.value = car.price_policy['8-20'] || '';
          if (price21_45Input) price21_45Input.value = car.price_policy['21-45'] || '';
          if (price46Input) price46Input.value = car.price_policy['46+'] || '';
        }
        
        // Fill in additional specifications
        const luggageInput = editForm.querySelector('input[name="luggage"]');
        const mileageInput = editForm.querySelector('input[name="mileage"]');
        const driveSelect = editForm.querySelector('select[name="drive"]');
        const fuelEconomyInput = editForm.querySelector('input[name="fuel_economy"]');
        const exteriorColorInput = editForm.querySelector('input[name="exterior_color"]');
        const interiorColorInput = editForm.querySelector('input[name="interior_color"]');
        const rcaInsuranceInput = editForm.querySelector('input[name="rca_insurance_price"]');
        const cascoInsuranceInput = editForm.querySelector('input[name="casco_insurance_price"]');
        
        if (luggageInput) luggageInput.value = car.luggage || '';
        if (mileageInput) mileageInput.value = car.mileage || '';
        if (driveSelect) driveSelect.value = car.drive || '';
        if (fuelEconomyInput) fuelEconomyInput.value = car.fuel_economy || '';
        if (exteriorColorInput) exteriorColorInput.value = car.exterior_color || '';
        if (interiorColorInput) interiorColorInput.value = car.interior_color || '';
        if (rcaInsuranceInput) rcaInsuranceInput.value = car.rca_insurance_price || '';
        if (cascoInsuranceInput) cascoInsuranceInput.value = car.casco_insurance_price || '';
        
        // Handle booked_until date
        const bookedUntilInput = editForm.querySelector('input[name="booked_until"]');
        if (bookedUntilInput) {
          if (car.booked_until) {
            const date = new Date(car.booked_until);
            const dateString = date.toISOString().split('T')[0];
            bookedUntilInput.value = dateString;
          } else {
            bookedUntilInput.value = '';
          }
        }
        
        // Show current images if they exist
        const editHeadImagePreview = document.getElementById('editHeadImagePreview');
        if (car.head_image && editHeadImagePreview) {
          editHeadImagePreview.innerHTML = `
            <div style="position: relative; display: inline-block;">
              <img src="${car.head_image}" alt="Current head image" style="max-width: 200px; max-height: 150px; border-radius: 4px;">
              <button type="button" class="btn btn-danger btn-sm" style="position: absolute; top: -8px; right: -8px; border-radius: 50%; width: 24px; height: 24px; padding: 0; font-size: 12px;" onclick="removeHeadImage()">×</button>
            </div>
          `;
        }
        
        const editGalleryImagesPreview = document.getElementById('editGalleryImagesPreview');
        if (car.gallery_images && car.gallery_images.length > 0 && editGalleryImagesPreview) {
          editGalleryImagesPreview.innerHTML = car.gallery_images.map((img, index) => `
            <div style="position: relative; display: inline-block; margin: 5px;">
              <img src="${img}" alt="Gallery image" style="max-width: 100px; max-height: 75px; border-radius: 4px;">
              <button type="button" class="btn btn-danger btn-sm" style="position: absolute; top: -8px; right: -8px; border-radius: 50%; width: 24px; height: 24px; padding: 0; font-size: 12px;" onclick="removeGalleryImage(${index})">×</button>
            </div>
          `).join('');
        }
        
        // Store car ID for form submission
        editForm.dataset.carId = carId;
        
        // Show the edit panel
        const editCarPanel = document.getElementById('editCarPanel');
        const adminOverlay = document.getElementById('adminOverlay');
        editCarPanel.classList.add('active');
        adminOverlay.classList.add('active');
        document.body.classList.add('admin-popup-open');
        
      } catch (error) {
        console.error('Error loading car for editing:', error);
        showCustomAlert('Error loading car data', 'error');
      }
    }

    async function deleteCar(carId) {
      if (confirm('Are you sure you want to delete this car?')) {
        try {
          const response = await fetch(`${window.API_BASE_URL}/api/cars/${carId}`, {
            method: 'DELETE'
          });
          
          if (response.ok) {
            showCustomAlert('Car deleted successfully!', 'success');
            loadCars();
          } else {
            const error = await response.json();
            showCustomAlert('Error deleting car: ' + error.error, 'error');
          }
        } catch (error) {
          console.error('Error deleting car:', error);
          showCustomAlert('Error deleting car', 'error');
        }
      }
    }

    async function editCoupon(couponId) {
      // Implementation for editing coupon
      showCustomAlert('Edit coupon functionality coming soon!', 'info');
    }

    async function deleteCoupon(couponId) {
      if (confirm('Are you sure you want to delete this coupon?')) {
        try {
          const response = await fetch(`${window.API_BASE_URL}/api/coupons/${couponId}`, {
            method: 'DELETE'
          });
          
          if (response.ok) {
            showCustomAlert('Coupon deleted successfully!', 'success');
            loadCoupons();
          } else {
            const error = await response.json();
            showCustomAlert('Error deleting coupon: ' + error.error, 'error');
          }
        } catch (error) {
          console.error('Error deleting coupon:', error);
          showCustomAlert('Error deleting coupon', 'error');
        }
      }
    }


    </script>
    
            <!-- Global formatting function -->
        <script>
            // Global formatting function
            function formatDisplayText(rawKey) {
              if (!rawKey) return '';
              return rawKey
                .split('_')
                .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())
                .join(' ');
            }
        </script>
        
        <!-- Autocomplete functionality -->
        <script>
            // Initialize autocomplete functionality
            function initializeAutocomplete() {
          // Data for autocomplete
          const makes = [
            'bmw', 'mercedes', 'audi', 'volkswagen', 'toyota', 'honda', 'ford', 'chevrolet', 
            'nissan', 'hyundai', 'kia', 'mazda', 'subaru', 'volvo', 'lexus', 'infiniti', 
            'acura', 'buick', 'cadillac', 'chrysler', 'dodge', 'jeep', 'ram', 'gmc', 
            'pontiac', 'saturn', 'oldsmobile', 'plymouth', 'eagle', 'tesla', 'ferrari', 
            'lamborghini', 'porsche', 'maserati', 'aston_martin', 'bentley', 'rolls_royce', 
            'mclaren', 'bugatti', 'koenigsegg', 'pagani', 'rimac', 'lotus', 'alpine', 
            'caterham', 'ariel', 'noble', 'radical', 'ultima', 'zenvo', 'gumpert', 
            'saleen', 'hennessey', 'callaway', 'ruf', 'techart', 'mansory', 'brabus', 
            'alpina', 'hamann', 'hartge', 'ac_schnitzer', 'dinan', 'vorsteiner', 'hre', 
            'adv_1', 'forgiato', 'vossen', 'rohana', 'titan7', 'volk', 'work', 'rays', 
            'enkei', 'bbs', 'oz', 'ssr', 'weds', 'gram_lights', 'volk_racing', 
            'work_emotion', 'volk_te37', 'volk_ce28', 'volk_re30', 'volk_gt_c', 
            'volk_gt_n', 'volk_gt_v', 'volk_gt_u', 'volk_gt_f', 'volk_gt_m', 'volk_gt_s', 
            'volk_gt_t', 'volk_gt_w', 'volk_gt_x', 'volk_gt_y', 'volk_gt_z'
          ];
          
          const models = [
            '3_series', '5_series', 'x3', 'x5', 'x7', 'z4', 'm3', 'm5', 'm8',
            'c_class', 'e_class', 's_class', 'gla', 'glc', 'gle', 'gls', 'amg_gt',
            'a3', 'a4', 'a6', 'a8', 'q3', 'q5', 'q7', 'q8', 'rs6', 'rs7',
            'golf', 'passat', 'tiguan', 'atlas', 'id4',
            'camry', 'corolla', 'rav4', 'highlander', 'prius',
            'civic', 'accord', 'cr_v', 'pilot',
            'focus', 'fusion', 'escape', 'explorer',
            'cruze', 'malibu', 'equinox', 'tahoe',
            'sentra', 'altima', 'rogue', 'murano',
            'elantra', 'sonata', 'tucson', 'santa_fe',
            'forte', 'optima', 'sportage', 'sorento',
            'mazda3', 'mazda6', 'cx5', 'cx9',
            'impreza', 'legacy', 'forester', 'outback',
            's60', 's90', 'xc40', 'xc60', 'xc90',
            'es', 'ls', 'rx', 'nx', 'gx', 'lx',
            'q50', 'q70', 'qx50', 'qx60',
            'tlx', 'rlx', 'rdx', 'mdx',
            'regal', 'lacrosse', 'encore', 'enclave',
            'cts', 'ct6', 'xt4', 'xt5', 'escalade',
            '300', 'pacifica', 'charger', 'challenger', 'durango',
            'cherokee', 'grand_cherokee', 'wrangler',
            '1500', '2500', '3500', 'terrain', 'acadia', 'yukon',
            'model_3', 'model_s', 'model_x', 'model_y',
            'f8', 'sf90', 'roma', 'huracan', 'aventador', 'urus',
            '911', 'cayenne', 'macan', 'ghibli', 'quattroporte', 'levante',
            'db11', 'vantage', 'dbs', 'continental', 'flying_spur', 'bentayga',
            'phantom', 'ghost', 'cullinan', '720s', '765lt', 'artura',
            'chiron', 'veyron', 'jesko', 'regera', 'huayra', 'zonda',
            'nevera', 'emira', 'evija', 'a110', 'seven', 'atom', 'm600',
            'sr3', 'evo', 'ts1', 'apollo', 's7', 'venom', 'corvette',
            'ctr', 'gt_street', 'mercedes', 'bmw', 'wheels'
          ];
          
          const colors = [
            'white', 'black', 'silver', 'gray', 'red', 'blue', 'green', 'yellow', 'orange', 
            'purple', 'brown', 'beige', 'gold', 'bronze', 'copper', 'chrome', 'matte_black', 
            'matte_white', 'matte_gray', 'matte_red', 'matte_blue', 'matte_green', 'matte_yellow', 
            'matte_orange', 'matte_purple', 'matte_brown', 'matte_beige', 'matte_gold', 
            'matte_bronze', 'matte_copper', 'matte_chrome', 'pearl_white', 'pearl_black', 
            'pearl_silver', 'pearl_gray', 'pearl_red', 'pearl_blue', 'pearl_green', 'pearl_yellow', 
            'pearl_orange', 'pearl_purple', 'pearl_brown', 'pearl_beige', 'pearl_gold', 
            'pearl_bronze', 'pearl_copper', 'pearl_chrome', 'metallic_white', 'metallic_black', 
            'metallic_silver', 'metallic_gray', 'metallic_red', 'metallic_blue', 'metallic_green', 
            'metallic_yellow', 'metallic_orange', 'metallic_purple', 'metallic_brown', 'metallic_beige', 
            'metallic_gold', 'metallic_bronze', 'metallic_copper', 'metallic_chrome', 'candy_white', 
            'candy_black', 'candy_silver', 'candy_gray', 'candy_red', 'candy_blue', 'candy_green', 
            'candy_yellow', 'candy_orange', 'candy_purple', 'candy_brown', 'candy_beige', 'candy_gold', 
            'candy_bronze', 'candy_copper', 'candy_chrome', 'chameleon_white', 'chameleon_black', 
            'chameleon_silver', 'chameleon_gray', 'chameleon_red', 'chameleon_blue', 'chameleon_green', 
            'chameleon_yellow', 'chameleon_orange', 'chameleon_purple', 'chameleon_brown', 'chameleon_beige', 
            'chameleon_gold', 'chameleon_bronze', 'chameleon_copper', 'chameleon_chrome'
          ];
          
          // Function to create autocomplete
          function createAutocomplete(inputId, dropdownId, options) {
            const input = document.getElementById(inputId);
            const dropdown = document.getElementById(dropdownId);
            
            if (!input || !dropdown) return;
            
            let selectedIndex = -1;
            
            function filterOptions(query) {
              return options.filter(option => 
                option.toLowerCase().includes(query.toLowerCase())
              );
            }
            
            function highlightMatch(text, query) {
              const regex = new RegExp(`(${query})`, 'gi');
              return text.replace(regex, '<span class="autocomplete-highlight">$1</span>');
            }
            

            
            function showDropdown(filteredOptions) {
              dropdown.innerHTML = '';
              
              if (filteredOptions.length === 0) {
                dropdown.style.display = 'none';
                return;
              }
              
              filteredOptions.forEach((option, index) => {
                const item = document.createElement('div');
                item.className = 'autocomplete-item';
                
                // Format display text using the new function
                const displayText = formatDisplayText(option);
                
                item.innerHTML = highlightMatch(displayText, input.value);
                item.dataset.value = option;
                
                item.addEventListener('click', () => {
                  // Set the formatted display text for user experience
                  input.value = displayText;
                  // Store the raw key in a data attribute for validation
                  input.dataset.rawValue = option;
                  dropdown.style.display = 'none';
                  selectedIndex = -1;
                  input.classList.remove('is-invalid'); // Clear any error state
                  input.classList.add('is-valid'); // Mark as valid
                });
                
                item.addEventListener('mouseenter', () => {
                  selectedIndex = index;
                  updateSelection();
                });
                
                dropdown.appendChild(item);
              });
              
              dropdown.style.display = 'block';
              selectedIndex = -1;
              updateSelection();
            }
            
            function updateSelection() {
              const items = dropdown.querySelectorAll('.autocomplete-item');
              items.forEach((item, index) => {
                item.classList.toggle('selected', index === selectedIndex);
              });
            }
            
            function hideDropdown() {
              dropdown.style.display = 'none';
              selectedIndex = -1;
            }
            
            // Event listeners
            input.addEventListener('input', (e) => {
              const query = e.target.value;
              const filteredOptions = filterOptions(query);
              showDropdown(filteredOptions);
              
              // Don't validate during typing - let user type freely
              // Validation will happen on blur or form submission
            });
            
            input.addEventListener('keydown', (e) => {
              const items = dropdown.querySelectorAll('.autocomplete-item');
              
              if (e.key === 'ArrowDown') {
                e.preventDefault();
                selectedIndex = Math.min(selectedIndex + 1, items.length - 1);
                updateSelection();
              } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                selectedIndex = Math.max(selectedIndex - 1, -1);
                updateSelection();
              } else if (e.key === 'Enter') {
                e.preventDefault();
                if (selectedIndex >= 0 && items[selectedIndex]) {
                  input.value = items[selectedIndex].dataset.value;
                  hideDropdown();
                }
              } else if (e.key === 'Escape') {
                hideDropdown();
              }
            });
            
            // Hide dropdown when clicking outside
            document.addEventListener('click', (e) => {
              if (!input.contains(e.target) && !dropdown.contains(e.target)) {
                hideDropdown();
              }
            });
            
            // Add validation on blur
            input.addEventListener('blur', () => {
              setTimeout(() => {
                const currentValue = input.value;
                const rawValue = input.dataset.rawValue;
                
                // Check if the value is a valid option (either exact match or has stored raw value)
                const isValid = options.includes(currentValue) || (rawValue && options.includes(rawValue));
                
                if (currentValue && !isValid) {
                  // Only clear if it's not a valid option and not empty
                  input.value = '';
                  delete input.dataset.rawValue;
                  input.classList.add('is-invalid');
                  input.classList.remove('is-valid');
                } else if (currentValue && isValid) {
                  input.classList.remove('is-invalid');
                  input.classList.add('is-valid');
                } else {
                  input.classList.remove('is-invalid', 'is-valid');
                }
              }, 200);
            });
          }
          
          // Initialize autocomplete for each field
          createAutocomplete('add_make_name', 'add_make_name_dropdown', makes);
          createAutocomplete('add_model_name', 'add_model_name_dropdown', models);
          createAutocomplete('add_exterior_color', 'add_exterior_color_dropdown', colors);
          createAutocomplete('add_interior_color', 'add_interior_color_dropdown', colors);
        }
        
        // Initialize autocomplete when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
          initializeAutocomplete();
        });
    </script>
</body>

</html>