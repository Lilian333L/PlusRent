<!DOCTYPE html>
<html lang="zxx">

<head>
    <title>PlusRent - Multipurpose Vehicle Car Rental Website Template</title>
    <link rel="icon" href="images/icon.png" type="image/gif" sizes="16x16">
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="PlusRent - Multipurpose Vehicle Car Rental Website Template" name="description">
    <meta content="" name="keywords">
    <meta content="" name="author">
    <!-- CSS Files
    ================================================== -->
    <link href="css/bootstrap.min.css" rel="stylesheet" type="text/css" id="bootstrap">
    <link href="css/mdb.min.css" rel="stylesheet" type="text/css" id="mdb">
    <link href="css/plugins.css" rel="stylesheet" type="text/css">
    <link href="css/style.css" rel="stylesheet" type="text/css">
    <link href="css/coloring.css" rel="stylesheet" type="text/css">
    <!-- color scheme -->
    <link id="colors" href="css/colors/scheme-01.css" rel="stylesheet" type="text/css">
    <!-- Ensure config.js is loaded first -->
    <script src="js/config.js"></script>
</head>

<body>
    <div id="wrapper">
        
        <!-- page preloader begin -->
        <div id="de-preloader"></div>
        <!-- page preloader close -->

        <!-- header begin -->
        <header class="transparent scroll-light has-topbar">
            <div id="topbar" class="topbar-dark text-light">
                <div class="container">
                    <div class="topbar-left xs-hide">
                        <div class="topbar-widget">
                            <div class="topbar-widget"><a href="#"><i class="fa fa-phone"></i>+208 333 9296</a></div>
                            <div class="topbar-widget"><a href="#"><i class="fa fa-envelope"></i>contact@plusrent.com</a></div>
                            <div class="topbar-widget"><a href="#"><i class="fa fa-clock-o"></i>Mon - Fri 08.00 - 18.00</a></div>
                        </div>
                    </div>
                
                    <div class="topbar-right">
                        <div class="social-icons">
                            <a href="#"><i class="fa fa-facebook fa-lg"></i></a>
                            <a href="#"><i class="fa fa-twitter fa-lg"></i></a>
                            <a href="#"><i class="fa fa-youtube fa-lg"></i></a>
                            <a href="#"><i class="fa fa-pinterest fa-lg"></i></a>
                            <a href="#"><i class="fa fa-instagram fa-lg"></i></a>
                        </div>
                    </div>  
                    <div class="clearfix"></div>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <div class="de-flex sm-pt10">
                            <div class="de-flex-col">
                                <div class="de-flex-col">
                                    <!-- logo begin -->
                                    <div id="logo">
                                        <a href="index.html">
                                            <img class="logo-1" src="images/logo-light.png" alt="">
                                            <img class="logo-2" src="images/logo.png" alt="">
                                        </a>
                                    </div>
                                    <!-- logo close -->
                                </div>
                            </div>
                            <div class="de-flex-col header-col-mid">
                                <ul id="mainmenu">
                                    <li><a class="menu-item" href="index.html">Home</a></li>
                                    <li><a class="menu-item" href="cars.html">Cars</a></li>
                                    <li><a class="menu-item" href="quick-booking.html">Booking</a></li>
                                    <li><a class="menu-item" href="account-dashboard.html">Admin Panel</a></li>
                                </ul>
                            </div>
                            <div class="de-flex-col">
                                <div class="menu_side_area">
                                    <a href="login.html" class="btn-main">Sign In</a>
                                    <span id="menu-btn"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>
            <!-- header close -->
        <!-- content begin -->
        <div class="no-bottom no-top zebra" id="content">
            <div id="top"></div>
            
            <!-- section begin -->
            <section id="subheader" class="jarallax text-light">
                <img src="images/background/2.jpg" class="jarallax-img" alt="">
                    <div class="center-y relative text-center">
                        <div class="container">
                            <div class="row">
                                <div class="col-md-12 text-center">
									<h1>Cars</h1>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                        </div>
                    </div>
            </section>
            <!-- section close -->

            <!-- Sidebar filter and car list layout -->
<div class="container cars-main-container">
                    <div class="row">
                        
    <div class="col-lg-3 col-md-4 small-sidebar">
        <!-- MOBILE FILTER DRAWER START -->
<button class="mobile-filter-btn" id="openFilterBtn">
  <span class="filter-icon" aria-hidden="true">
    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#222" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:middle;">
      <path d="M.75 4.5h16.34a3.5 3.5 0 1 0 0-1.5H.75a.75.75 0 0 0 0 1.5M20.5 1.75a2 2 0 1 1-2 2 2 2 0 0 1 2-2m2.75 17.75H9.46a3.5 3.5 0 0 0-6.83 0H.75a.75.75 0 0 0 0 1.5h1.88a3.5 3.5 0 0 0 6.83 0h13.79a.75.75 0 0 0 0-1.5m-17.2 2.75a2 2 0 1 1 2-2 2 2 0 0 1-2 2M23.25 11h-7.84a3.49 3.49 0 0 0-6.82 0H.75a.75.75 0 0 0 0 1.5h7.84a3.49 3.49 0 0 0 6.82 0h7.84a.75.75 0 0 0 0-1.5M12 13.75a2 2 0 1 1 2-2 2 2 0 0 1-2 2"/>
    </svg>
  </span>
  <span class="filter-btn-label">Filter</span>
</button>
<div class="filter-overlay" id="filterOverlay"></div>
<!-- MOBILE FILTER DRAWER END -->
      <div class="filter-sidebar">
        <div class="filter-title">
          Filter
          <a class="filter-clear" id="clear-filters-link">Clear all filters</a>
                                    </div>
        <hr class="filter-divider">
        <div class="filter-category">
          <h6 class="filter-section-title">Make</h6>
          <div id="filter-make-options"></div>
                                    </div>
        <hr class="filter-divider">
        <div class="filter-category">
          <h6 class="filter-section-title">Gear</h6>
          <div id="filter-gear-options"></div>
                                    </div>
        <hr class="filter-divider">
        <div class="filter-category">
          <h6 class="filter-section-title">Fuel</h6>
          <div id="filter-fuel-options"></div>
                                </div>
        <hr class="filter-divider">
        <div class="filter-category">
          <h6 class="filter-section-title">Type</h6>
          <div id="filter-type-options"></div>
                            </div>
        <hr class="filter-divider">
        <div class="filter-category">
          <h6 class="filter-section-title">Doors</h6>
          <div id="filter-doors-options"></div>
                                    </div>
        <hr class="filter-divider">
        <div class="filter-category">
          <h6 class="filter-section-title">Passengers</h6>
          <div id="filter-passengers-options"></div>
                                    </div>
        <hr class="filter-divider">
        <div class="filter-category">
          <h6 class="filter-section-title">Price</h6>
          <div style="display: flex; gap: 8px; align-items: center;">
            <input type="number" id="filter-price-min" class="form-control" placeholder="From" min="0" style="width: 70px;">
            <span>-</span>
            <input type="number" id="filter-price-max" class="form-control" placeholder="To" min="0" style="width: 70px;">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
    <div class="col-lg-9 col-md-8">
      <div class="row car-list-row" id="car-list"></div>
                                        </div>
                                    </div>
                                </div>

<style>
@media (min-width: 992px) {
  .col-lg-9 {
    width: 82%;
    flex: 0 0 82%;
    max-width: 82%;
  }
}
.cars-main-container {
  padding-top: 2.5rem;
  padding-bottom: 2.5rem;
}
.small-sidebar {
  max-width: 18%;
}
.filter-sidebar {
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.04);
  /* padding: 1.5rem 1.2rem 1.2rem 1.2rem; */
  min-width: 220px;
  max-width: 260px;
  padding:1em;
}
.filter-title {
  font-size: 1.35rem;
  font-weight: 700;
  margin-bottom: 0.7rem;
  letter-spacing: 0.01em;
}
.filter-clear {
  float: right;
  color: #1976d2;
  font-size: 0.8rem;
  font-weight: 500;
  cursor: pointer;
  text-decoration: none;
}
.filter-divider {
  border: none;
  border-top: 1.5px solid #9e9797;
  margin: 1.1rem 0 1.1rem 0;
}
.filter-section-title {
  font-size: 1.08rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
  margin-top: 1.2rem;
  letter-spacing: 0.01em;
}
.filter-option-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding-right: 2px;
  margin-bottom: 6px;
}
.filter-option-row label {
  display: flex;
  align-items: center;
  font-size: 1rem;
  font-weight: 400;
  cursor: pointer;
  flex: 1 1 auto;
}
.filter-option-row input[type=checkbox] {
  width: 20px;
  height: 20px;
  margin-right: 10px;
  accent-color: #1976d2;
}
.option-label {
  margin-right: 8px;
}
.option-count {
  color: #222;
  font-size: 1rem;
  font-weight: 500;
  min-width: 24px;
  text-align: right;
  margin-left: 10px;
  background: none;
  padding: 0;
  border-radius: 0;
  display: inline-block;
}
.car-list-row {
  margin-left: 0;
  margin-right: 0;
  gap: 1.5rem 0;
}
.car-list-row > .col-xl-4, .car-list-row > .col-lg-6 {
  padding-left: 10px;
  padding-right: 10px;
  margin-bottom: 24px;
  max-width: 320px;
  flex: 1 1 260px;
  min-width: 240px;
  width: 100%;
}
.de-item.mb30 {
  transition: box-shadow 0.25s, transform 0.25s;
  margin-bottom: 0 !important;
  border-radius: 10px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.04);
  padding: 0.7rem 0.7rem 1.1rem 0.7rem;
}
.car-unavailable {
  opacity: 0.6;
  pointer-events: none;
  filter: grayscale(0.7);
}
.img-unavailable img{
    filter: grayscale(0.22) brightness(0.96);
}
.btn-main.disabled, .btn-main[aria-disabled="true"] {
  background: #aaa !important;
  color: #fff !important;
  cursor: not-allowed !important;
  pointer-events: none;
}
.booked-until-badge {
  position: absolute;
  top: 12px;
  left: 12px;
  background: rgba(60,60,60,0.82);
  color: #fff;
  font-size: 0.98rem;
  font-weight: 500;
  padding: 6px 14px;
  border-radius: 6px;
  z-index: 2;
  box-shadow: 0 2px 8px rgba(0,0,0,0.10);
  pointer-events: none;
}
.d-img {
  position: relative;
}

.unavailable-badge {
  position: absolute;
  top: 0px;
  right: 0;
  background: #ff6b5b;
  color: #fff;
  font-size: 0.52rem;
  font-weight: 700;
  letter-spacing: 0.04em;
  text-transform: uppercase;
  padding: 5px 14px 4px 14px;
  border-radius: 7px;
  z-index: 2;
  box-shadow: 0 2px 8px rgba(0,0,0,0.10);
  pointer-events: none;
  border: none;
}
.btn-unavailable {
  background: #ececec !important;
  color: #888 !important;
  border: 2px solid #ececec !important;
  cursor: not-allowed !important;
  pointer-events: none;
  font-weight: 700;
  border-radius: 8px;
  /* padding: 0.7rem 2.2rem; */
  margin-top: 0.7rem;
  display: inline-block;
  box-shadow: 0 1px 4px rgba(0,0,0,0.04);
  transition: background 0.2s, color 0.2s, border 0.2s;
}
.btn-main {
  transition: background 0.2s, color 0.2s, border 0.2s, box-shadow 0.2s;
}
.filter-option-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding-right: 2px;
  margin-bottom: 2px;
}
.option-label {
  margin-right: 8px;
}

/* --- MOBILE FILTER DRAWER STYLES START --- */
.mobile-filter-btn {
  display: none;
  align-items: center;
  background: #fff;
  color: #222;
  border: none;
  border-radius: 8px;
  font-size: 1.25rem;
  font-weight: 400;
  padding: 0.5em 1.2em 0.5em 0.8em;
  /* box-shadow: 0 1px 4px rgba(0,0,0,0.08); */
  transition: background 0.18s, box-shadow 0.18s;
  cursor: pointer;
}
.mobile-filter-btn:active,
.mobile-filter-btn:focus {
  background: #f2f2f2;
  outline: none;
}
.filter-icon {
  display: inline-flex;
  align-items: center;
  margin-right: 0.3em;
}
.filter-btn-label {
  font-weight: 500;
  font-size: 0.9em;
  letter-spacing: 0.01em;
}
@media (max-width: 767px) {
  .mobile-filter-btn {
    display: flex;
  }
}
.filter-overlay {
  display: none;
  position: fixed;
  z-index: 1001;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(0,0,0,0.25);
}
.filter-sidebar.mobile-active {
  display: block !important;
  position: fixed;
  z-index: 1002;
  top: 0;
  left: 0;
  width: 90vw;
  max-width: 340px;
  height: 100vh;
  overflow-y: auto;
  background: #fff;
  box-shadow: 2px 0 16px rgba(0,0,0,0.12);
  animation: slideInSidebar 0.25s;
  
}
@keyframes slideInSidebar {
  from { transform: translateX(-100%); }
  to { transform: translateX(0); }
}
@media (max-width: 767px) {
  .filter-sidebar {
    display: none;
  }
  .filter-sidebar.mobile-active {
    display: block;
  }
}
/* --- MOBILE FILTER DRAWER STYLES END --- */

@media (max-width: 991px) {
  .small-sidebar { max-width: 100%; margin-bottom: 2rem; }
  .cars-main-container { padding-left: 0.5rem; padding-right: 0.5rem; }
}
@media (max-width: 600px) {
  .car-list-row > .col-xl-4, .car-list-row > .col-lg-6 {
    min-width: 100%;
    max-width: 100%;
    padding-left: 0;
    padding-right: 0;
  }
  .cars-main-container { padding-left: 0.2rem; padding-right: 0.2rem; }
}

/* --- Responsive fix: prevent car cards from overlapping sidebar between 992px and 1400px --- */
@media (min-width: 992px) {
  .small-sidebar, .filter-sidebar {
    min-width: 220px;
    max-width: 260px;
  }
  .col-lg-3 {
    width: 220px;
    flex: 0 0 220px;
    max-width: 260px;
  }
  .col-lg-9 {
    width: calc(100% - 220px);
    flex: 1 1 0;
    max-width: calc(100% - 220px);
  }
}
@media (min-width: 1400px) {
  .col-lg-3 {
    width: 260px;
    flex: 0 0 260px;
    max-width: 300px;
  }
  .col-lg-9 {
    width: calc(100% - 260px);
    max-width: calc(100% - 260px);
  }
}
/* --- Switch car-list-row to CSS Grid for better row control --- */
.car-list-row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 1.5rem 0;
  justify-items: start; /* left-align by default */
}
@media (min-width: 992px) {
  .car-list-row {
    grid-template-columns: repeat(3, 1fr); /* 3 cards per row on desktop */
  }
}
/* --- End CSS Grid car-list-row --- */
</style>

<script>
// Helper: get all unique values for a field from cars array
function getUniqueOptions(cars, field) {
  return Array.from(new Set(cars.map(car => car[field]).filter(Boolean))).sort();
}

// Render checkboxes for a filter category
function renderFilterOptions(containerId, options, selectedValues, allCarsFull, currentFilters, field) {
  const container = document.getElementById(containerId);
  container.innerHTML = options.map(opt => {
    const newFilters = { ...currentFilters };
    const alreadySelected = selectedValues.includes(String(opt));
    let filterVals = alreadySelected ? selectedValues : [...selectedValues, String(opt)];
    newFilters[field] = filterVals;
    const count = allCarsFull.filter(car => {
      for (const key in newFilters) {
        if (!newFilters[key] || !newFilters[key].length) continue;
        if (!newFilters[key].includes(String(car[key]))) return false;
      }
      return true;
    }).length;
    return `
      <div class="filter-option-row">
        <label>
          <input type="checkbox" value="${opt}" ${selectedValues.includes(String(opt)) ? 'checked' : ''}>
          <span class="option-label">${opt}</span>
        </label>
        <span class="option-count">${count}</span>
                                        </div>
    `;
  }).join('');
}

function getCurrentSidebarFilters() {
  const params = new URLSearchParams(window.location.search);
  return {
    make_name: params.get('make_name') ? params.get('make_name').split(',') : [],
    gear_type: params.get('gear_type') ? params.get('gear_type').split(',') : [],
    fuel_type: params.get('fuel_type') ? params.get('fuel_type').split(',') : [],
    car_type: params.get('car_type') ? params.get('car_type').split(',') : [],
    num_doors: params.get('num_doors') ? params.get('num_doors').split(',') : [],
    num_passengers: params.get('num_passengers') ? params.get('num_passengers').split(',') : [],
    // price is not included in count logic for now
  };
}

// Get selected values from all checkboxes in a container
function getSelectedValues(containerId) {
  return Array.from(document.querySelectorAll(`#${containerId} input[type=checkbox]:checked`)).map(cb => cb.value);
}

// Update URL and fetch cars
function updateFiltersAndFetch() {
  const make = getSelectedValues('filter-make-options');
  const gear = getSelectedValues('filter-gear-options');
  const fuel = getSelectedValues('filter-fuel-options');
  const type = getSelectedValues('filter-type-options');
  const doors = getSelectedValues('filter-doors-options');
  const passengers = getSelectedValues('filter-passengers-options');
  const priceMin = document.getElementById('filter-price-min').value;
  const priceMax = document.getElementById('filter-price-max').value;
  const params = new URLSearchParams();
  if (make.length) params.set('make_name', make.join(','));
  if (gear.length) params.set('gear_type', gear.join(','));
  if (fuel.length) params.set('fuel_type', fuel.join(','));
  if (type.length) params.set('car_type', type.join(','));
  if (doors.length) params.set('num_doors', doors.join(','));
  if (passengers.length) params.set('num_passengers', passengers.join(','));
  if (priceMin) params.set('min_price', priceMin);
  if (priceMax) params.set('max_price', priceMax);
  const newUrl = window.location.pathname + (params.toString() ? '?' + params.toString() : '');
  window.history.pushState({}, '', newUrl);
  fetchAndRenderCars();
}

// Fetch and render cars based on current filters
async function fetchAndRenderCars() {
  const carListDiv = document.getElementById('car-list');
  const res = await fetch(`${window.API_BASE_URL}/api/cars${window.location.search}`);
  const cars = await res.json();
  if (!cars.length) {
      carListDiv.innerHTML = '<div>No cars available.</div>';
      renderSidebarOptions([]); // This will now be handled by renderSidebarOptions
      return;
    }
    carListDiv.innerHTML = cars.map(car => {
      console.log(car.num_doors);
    const isUnavailable = car.booked_until && !car.is_available;
    let badge = '';
    if (isUnavailable && car.booked_until) {
      const d = new Date(car.booked_until);
      const options = { day: '2-digit', month: 'short', year: 'numeric' };
      const formatted = d.toLocaleDateString(undefined, options).toUpperCase();
      badge = `<div class="unavailable-badge">UNAVAILABLE UNTIL ${formatted}</div>`;
    }
    return `
                                <div class="col-xl-4 col-lg-6">
                                    <div class="de-item mb30">
          <div class="d-img${isUnavailable ? ' img-unavailable' : ''}">
            <img src="${car.head_image ? window.API_BASE_URL + car.head_image : window.API_BASE_URL + '/uploads/placeholder.png'}" class="img-fluid" alt="">
            ${badge}
                                        </div>
                                        <div class="d-info">
                                            <div class="d-text">
              <h4>${car.make_name}</h4>
              <p>${car.model_name}</p>
                                                <div class="d-item_like">
                <i class="fa fa-heart"></i><span>${car.likes || 0}</span>
                                        </div>
                                        <div class="d-atr-group">
                <span class="d-atr">
                  <!-- Turquoise passengers icon -->
                  <svg width="16" viewBox="0 0 24 24" fill="none" stroke="#1DE9B6" >
                    <path d="M16.5 6a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0M18 6A6 6 0 1 0 6 6a6 6 0 0 0 12 0M3 23.25a9 9 0 1 1 18 0 .75.75 0 0 0 1.5 0c0-5.799-4.701-10.5-10.5-10.5S1.5 17.451 1.5 23.25a.75.75 0 0 0 1.5 0"/>
                  </svg>
                  ${car.num_passengers || '-'}
                </span>
                <span class="d-atr">
                  <!-- Turquoise gear type icon -->
                  <svg width="16px" viewBox="0 0 24 24" fill="none" stroke="#1DE9B6">
                    <path d="M1.5 6.75v-3a.75.75 0 0 0-1.5 0v3a.75.75 0 0 0 1.5 0m2.85-.45-2.25-3a.75.75 0 1 0-1.2.9l2.25 3a.75.75 0 1 0 1.2-.9m18.9 13.95h-3L21 21v-.75A2.25 2.25 0 0 1 23.25 18l-.75-.75v6a.75.75 0 0 0 1.5 0v-6a.75.75 0 0 0-.75-.75 3.75 3.75 0 0 0-3.75 3.75V21c0 .414.336.75.75.75h3a.75.75 0 0 0 0-1.5M18.024 2.056A.75.75 0 1 1 18.75 3v1.5a.75.75 0 1 1-.722.95.75.75 0 1 0-1.446.4A2.25 2.25 0 1 0 18.75 3c-1 0-1 1.5 0 1.5a2.25 2.25 0 1 0-2.174-2.832.75.75 0 0 0 1.448.388M12 18.75a.75.75 0 0 1 1.5 0c0 .315-.107.622-.304.868l-2.532 3.163A.75.75 0 0 0 11.25 24h3a.75.75 0 0 0 0-1.5h-3l.586 1.219 2.532-3.164c.41-.513.632-1.15.632-1.805a2.25 2.25 0 0 0-4.5 0 .75.75 0 0 0 1.5 0M8.25 1.5H9v5.25a.75.75 0 0 0 1.5 0V1.5A1.5 1.5 0 0 0 9 0h-.75a.75.75 0 0 0 0 1.5m0 6h3a.75.75 0 0 0 0-1.5h-3a.75.75 0 0 0 0 1.5m-6-7.5H.75A.75.75 0 0 0 0 .75v3c0 .414.336.75.75.75h1.5a2.25 2.25 0 0 0 0-4.5m0 1.5a.75.75 0 0 1 0 1.5H.75l.75.75v-3l-.75.75zm8.25 11.25v-3a.75.75 0 0 0-1.5 0v3a.75.75 0 0 0 1.5 0m1.5 0v1.5a.75.75 0 0 0 1.5 0v-1.5a.75.75 0 0 0-1.5 0m7.5 0v-3a.75.75 0 0 0-1.5 0v3a.75.75 0 0 0 1.5 0m3 1.5A2.25 2.25 0 0 0 20.25 12h-15A2.25 2.25 0 0 1 3 9.75a.75.75 0 0 0-1.5 0 3.75 3.75 0 0 0 3.75 3.75h15a.75.75 0 0 1 .75.75.75.75 0 0 0 1.5 0"/>
                  </svg>
                  ${car.gear_type || '-'}
                </span>
                <span class="d-atr">
                  <!-- Turquoise door icon -->
                  <svg width="16px" height="16px" viewBox="-1 0 20 20" xmlns="http://www.w3.org/2000/svg" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g id="car-door-2" transform="translate(-3 -2)"> <path id="secondary" fill="#ffffff" d="M20,11v9a1,1,0,0,1-1,1H12a6.09,6.09,0,0,0-1.84-3.07,6.17,6.17,0,0,0-3.24-1.51l-2.06-.3a1,1,0,0,1-.86-1V11Z"></path> <path id="primary" d="M14,15h2M11.71,3.29,4,11v4.13a1,1,0,0,0,.86,1l2.06.3A6.11,6.11,0,0,1,12,21h7a1,1,0,0,0,1-1V4a1,1,0,0,0-1-1H12.41A1,1,0,0,0,11.71,3.29ZM4,11H20" fill="none" stroke="#1de9b6" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path> </g> </g></svg>
                  ${car.num_doors || '-'}
                </span>
                <span class="d-atr">
                  <!-- Turquoise car icon -->
                  <svg width="16px" viewBox="200 30.5 680 900" class="icon" version="1.1" xmlns="http://www.w3.org/2000/svg" fill="#000000"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round" stroke="#CCCCCC" stroke-width="2.1100000000000003"></g><g id="SVGRepo_iconCarrier"><path d="M705.638866 559.639753v-52.882555h111.674039V462.683177l-576.002939-18.620177v68.571779h119.510814v54.857422h-119.510814v98.931444h576.002939v-106.783892zM330.790259 251.732876l-13.07174 62.694198h428.420798l-20.908515-52.255614z" fill="#ffff"></path><path d="M275.901489 461.131496a15.673549 15.673549 0 0 1-15.219016-19.497896l44.309124-175.872897c4.670718-16.159429 21.645172-27.083893 41.440864-27.083893h362.49785c19.795693 0 36.770147 10.924464 41.299802 26.550992l15.861632 62.944974a15.673549 15.673549 0 1 1-30.406685 7.648692l-15.72057-62.412073c-0.376165-0.564248-4.404267-3.385487-11.049853-3.385487H346.432461c-6.645585 0-10.658014 2.836912-11.222261 4.012429l-44.121041 175.261629a15.689223 15.689223 0 0 1-15.18767 11.83353zM779.445609 461.131496c-7.006077 0-13.385211-4.733412-15.187669-11.849204l-14.921219-59.26169a15.673549 15.673549 0 1 1 30.406686-7.648692l14.921219 59.26169a15.673549 15.673549 0 0 1-15.219017 19.497896zM334.959423 785.338864c-36.25292 0-65.75054-29.356558-65.750539-65.452742v-45.296558a15.673549 15.673549 0 0 1 31.347098 0v45.296558c0 18.808259 15.422773 34.105643 34.403441 34.105643 18.964995 0 34.387767-15.297384 34.387768-34.105643v-45.296558a15.673549 15.673549 0 0 1 31.347098 0v45.296558c0.015674 36.096184-29.481946 65.452742-65.734866 65.452742zM720.387675 785.338864c-36.25292 0-65.75054-29.356558-65.750539-65.452742v-45.296558a15.673549 15.673549 0 0 1 31.347099 0v45.296558c0 18.808259 15.422773 34.105643 34.40344 34.105643s34.403441-15.297384 34.403441-34.105643v-45.296558a15.673549 15.673549 0 0 1 31.347099 0v45.296558c0 36.096184-29.49762 65.452742-65.75054 65.452742z" fill="#1de9b6"></path><path d="M800.824331 462.667503v190.261216H254.538442V462.667503h546.285889m7.366568-31.347098H247.1562c-13.244149 0-23.964857 10.736381-23.964857 23.964857v228.990556h608.980086v-228.990556a23.980531 23.980531 0 0 0-23.98053-23.964857z" fill="#1de9b6"></path><path d="M815.776897 621.409211H535.643549a15.673549 15.673549 0 0 1 0-31.347098h280.133348a15.673549 15.673549 0 0 1 0 31.347098zM488.513186 621.409211h-6.363461a15.673549 15.673549 0 0 1 0-31.347098h6.363461a15.673549 15.673549 0 0 1 0 31.347098zM415.944653 621.409211H246.591952a15.673549 15.673549 0 0 1 0-31.347098h169.352701a15.673549 15.673549 0 0 1 0 31.347098z" fill="#1de9b6"></path><path d="M735.559671 333.376395H311.527467a15.673549 15.673549 0 0 1 0-31.347099H735.559671a15.673549 15.673549 0 0 1 0 31.347099z" fill="#1de9b6"></path><path d="M422.323787 413.06072a15.673549 15.673549 0 0 1-9.466823-28.181042l45.798111-34.638544a15.673549 15.673549 0 0 1 18.9023 25.014985l-45.798111 34.638544a15.610855 15.610855 0 0 1-9.435477 3.166057z" fill="#1de9b6"></path><path d="M559.937551 413.06072a15.673549 15.673549 0 0 1-9.466824-28.181042l45.798111-34.638544a15.673549 15.673549 0 1 1 18.902301 25.014985l-45.798112 34.638544a15.610855 15.610855 0 0 1-9.435476 3.166057z" fill="#1de9b6"></path><path d="M340.821331 513.606539v28.447492H254.538442v-28.447492h86.282889m9.686253-31.347099H223.191343v91.14169h127.316241c11.958918 0 21.660845-9.701927 21.660845-21.660846v-47.819999c0-11.958918-9.701927-21.660845-21.660845-21.660845z" fill="#1de9b6"></path><path d="M800.824331 513.606539v28.447492h-86.282889v-28.447492h86.282889m31.347098-31.347099h-127.316241c-11.958918 0-21.660845 9.701927-21.660845 21.660845v47.819999c0 11.958918 9.701927 21.660845 21.660845 21.660846h127.316241v-91.14169z" fill="#1de9b6"></path></g></svg>
                  <strong>${car.car_type || '-'}</strong>
                </span>
                                                </div>
                                                <div class="d-price">
                Daily rate from <span>${car.price_policy ? car.price_policy['1-2'] + '€' : ''}</span>
                ${isUnavailable
                  ? '<span class="btn-main btn-unavailable" tabindex="-1" aria-disabled="true">Not Available</span>'
                  : `<a class="btn-main" href="car-single?id=${car.id}">Rent Now</a>`}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
    `;
  }).join('');
  renderSidebarOptions(allCarsFullCache); // Use the cached full list for sidebar
}

// Render sidebar options and attach event listeners
function renderSidebarOptions(allCarsFull) {
  const params = new URLSearchParams(window.location.search);
  const selectedMakes = params.get('make_name') ? params.get('make_name').split(',') : [];
  const selectedGears = params.get('gear_type') ? params.get('gear_type').split(',') : [];
  const selectedFuels = params.get('fuel_type') ? params.get('fuel_type').split(',') : [];
  const selectedTypes = params.get('car_type') ? params.get('car_type').split(',') : [];
  const selectedDoors = params.get('num_doors') ? params.get('num_doors').split(',') : [];
  const selectedPassengers = params.get('num_passengers') ? params.get('num_passengers').split(',') : [];
  const priceMin = params.get('min_price') ? params.get('min_price') : '';
  const priceMax = params.get('max_price') ? params.get('max_price') : '';
  const currentFilters = getCurrentSidebarFilters();

  renderFilterOptions('filter-make-options', getUniqueOptions(allCarsFull, 'make_name'), selectedMakes, allCarsFull, currentFilters, 'make_name');
  renderFilterOptions('filter-gear-options', getUniqueOptions(allCarsFull, 'gear_type'), selectedGears, allCarsFull, currentFilters, 'gear_type');
  renderFilterOptions('filter-fuel-options', getUniqueOptions(allCarsFull, 'fuel_type'), selectedFuels, allCarsFull, currentFilters, 'fuel_type');
  renderFilterOptions('filter-type-options', getUniqueOptions(allCarsFull, 'car_type'), selectedTypes, allCarsFull, currentFilters, 'car_type');
  renderFilterOptions('filter-doors-options', getUniqueOptions(allCarsFull, 'num_doors'), selectedDoors, allCarsFull, currentFilters, 'num_doors');
  renderFilterOptions('filter-passengers-options', getUniqueOptions(allCarsFull, 'num_passengers'), selectedPassengers, allCarsFull, currentFilters, 'num_passengers');
  document.getElementById('filter-price-min').value = priceMin;
  document.getElementById('filter-price-max').value = priceMax;

  // Attach change listeners
  ['filter-make-options','filter-gear-options','filter-fuel-options','filter-type-options','filter-doors-options','filter-passengers-options'].forEach(id => {
    document.getElementById(id).querySelectorAll('input[type=checkbox]').forEach(cb => {
      cb.addEventListener('change', updateFiltersAndFetch);
    });
  });
  document.getElementById('filter-price-min').addEventListener('change', updateFiltersAndFetch);
  document.getElementById('filter-price-max').addEventListener('change', updateFiltersAndFetch);
}

// Initial load
// On page load, fetch all cars once for sidebar options
let allCarsFullCache = [];
fetch(`${window.API_BASE_URL}/api/cars`).then(res => res.json()).then(allCarsFull => {
  allCarsFullCache = allCarsFull;
  renderSidebarOptions(allCarsFull);
});

window.addEventListener('popstate', fetchAndRenderCars);
document.addEventListener('DOMContentLoaded', fetchAndRenderCars);

document.getElementById('clear-filters-link').addEventListener('click', function(e) {
  e.preventDefault();
  window.history.pushState({}, '', window.location.pathname);
  fetchAndRenderCars();
  renderSidebarOptions(allCarsFullCache);
});

// --- MOBILE FILTER DRAWER JS START ---
const openFilterBtn = document.getElementById('openFilterBtn');
const filterSidebar = document.querySelector('.filter-sidebar');
const filterOverlay = document.getElementById('filterOverlay');
if (openFilterBtn && filterSidebar && filterOverlay) {
  openFilterBtn.addEventListener('click', function() {
    filterSidebar.classList.add('mobile-active');
    filterOverlay.style.display = 'block';
    document.body.style.overflow = 'hidden';
  });
  filterOverlay.addEventListener('click', function() {
    filterSidebar.classList.remove('mobile-active');
    filterOverlay.style.display = 'none';
    document.body.style.overflow = '';
  });
}
// --- MOBILE FILTER DRAWER JS END ---
</script>
			
			
        </div>
        <!-- content close -->

        <a href="#" id="back-to-top"></a>
        
        <!-- footer begin -->
        <footer class="text-light">
            <div class="container">
                <div class="row g-custom-x">
                    <div class="col-lg-3">
                        <div class="widget">
                            <h5>About PlusRent</h5>
                            <p>Where quality meets affordability. We understand the importance of a smooth and enjoyable journey without the burden of excessive costs. That's why we have meticulously crafted our offerings to provide you with top-notch vehicles at minimum expense.</p>
                        </div>
                    </div>
                    
                    <div class="col-lg-3">
                        <div class="widget">
                            <h5>Contact Info</h5>
                            <address class="s1">
                                <span><i class="id-color fa fa-map-marker fa-lg"></i>08 W 36th St, New York, NY 10001</span>
                                <span><i class="id-color fa fa-phone fa-lg"></i>+1 333 9296</span>
                                <span><i class="id-color fa fa-envelope-o fa-lg"></i><a href="mailto:contact@example.com">contact@example.com</a></span>
                                <span><i class="id-color fa fa-file-pdf-o fa-lg"></i><a href="#">Download Brochure</a></span>
                            </address>
                        </div>
                    </div>

                    <div class="col-lg-3">
                        <h5>Quick Links</h5>
                        <div class="row">
                            <div class="col-lg-6">
                                <div class="widget">
                                    <ul>
                                        <li><a href="#">About</a></li>
                                        <li><a href="#">Blog</a></li>
                                        <li><a href="#">Careers</a></li>
                                        <li><a href="#">News</a></li>
                                        <li><a href="#">Partners</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-3">
                        <div class="widget">
                            <h5>Social Network</h5>
                            <div class="social-icons">
                                <a href="#"><i class="fa fa-facebook fa-lg"></i></a>
                                <a href="#"><i class="fa fa-twitter fa-lg"></i></a>
                                <a href="#"><i class="fa fa-linkedin fa-lg"></i></a>
                                <a href="#"><i class="fa fa-pinterest fa-lg"></i></a>
                                <a href="#"><i class="fa fa-rss fa-lg"></i></a>
                            </div>
                        </div>    
                    </div>
                </div>
            </div>
            <div class="subfooter">
                <div class="container">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="de-flex">
                                <div class="de-flex-col">
                                    <a href="index.html">
                                        Copyright 2025 - PlusRent by Designesia
                                    </a>
                                </div>
                                <ul class="menu-simple">
                                    <li><a href="#">Terms &amp; Conditions</a></li>
                                    <li><a href="#">Privacy Policy</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
        <!-- footer close -->
        
    </div>


    <!-- Javascript Files
    ================================================== -->
    <script src="js/plugins.js"></script>
    <script src="js/designesia.js"></script>
    <script>
    </script>
</body>

</html>